(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/edit/matchbrackets"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/edit/matchbrackets"],a);else a(CodeMirror)})(function(a){"use strict";var b=a.keyMap.sublime={fallthrough:"default"};var c=a.commands;var d=a.Pos;var e=a.keyMap["default"]==a.keyMap.macDefault;var f=e?"Cmd-":"Ctrl-";function g(b,c,e){if(e<0&&c.ch==0)return b.clipPos(d(c.line-1));var f=b.getLine(c.line);if(e>0&&c.ch>=f.length)return b.clipPos(d(c.line+1,0));var g="start",h;for(var i=c.ch,j=e<0?0:f.length,k=0;i!=j;i+=e,k++){var l=f.charAt(e<0?i-1:i);var m=l!="_"&&a.isWordChar(l)?"w":"o";if(m=="w"&&l.toUpperCase()==l)m="W";if(g=="start"){if(m!="o"){g="in";h=m}}else if(g=="in"){if(h!=m){if(h=="w"&&m=="W"&&e<0)i--;if(h=="W"&&m=="w"&&e>0){h="w";continue}break}}}return d(c.line,i)}function h(a,b){a.extendSelectionsBy(function(c){if(a.display.shift||a.doc.extend||c.empty())return g(a.doc,c.head,b);else return b<0?c.from():c.to()})}c[b["Alt-Left"]="goSubwordLeft"]=function(a){h(a,-1)};c[b["Alt-Right"]="goSubwordRight"]=function(a){h(a,1)};var i=e?"Ctrl-Alt-":"Ctrl-";c[b[i+"Up"]="scrollLineUp"]=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top+b.clientHeight,"local");if(a.getCursor().line>=c)a.execCommand("goLineUp")}a.scrollTo(null,b.top-a.defaultTextHeight())};c[b[i+"Down"]="scrollLineDown"]=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top,"local")+1;if(a.getCursor().line<=c)a.execCommand("goLineDown")}a.scrollTo(null,b.top+a.defaultTextHeight())};c[b["Shift-"+f+"L"]="splitSelectionByLine"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e].from(),g=b[e].to();for(var h=f.line;h<=g.line;++h)if(!(g.line>f.line&&h==g.line&&g.ch==0))c.push({anchor:h==f.line?f:d(h,0),head:h==g.line?g:d(h)})}a.setSelections(c,0)};b["Shift-Tab"]="indentLess";c[b["Esc"]="singleSelectionTop"]=function(a){var b=a.listSelections()[0];a.setSelection(b.anchor,b.head,{scroll:false})};c[b[f+"L"]="selectLine"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e];c.push({anchor:d(f.from().line,0),head:d(f.to().line+1,0)})}a.setSelections(c)};b["Shift-"+f+"K"]="deleteLine";function j(a,b){a.operation(function(){var c=a.listSelections().length,e=[],f=-1;for(var g=0;g<c;g++){var h=a.listSelections()[g].head;if(h.line<=f)continue;var i=d(h.line+(b?0:1),0);a.replaceRange("\n",i,null,"+insertLine");a.indentLine(i.line,null,true);e.push({head:i,anchor:i});f=h.line+1}a.setSelections(e)})}c[b[f+"Enter"]="insertLineAfter"]=function(a){j(a,false)};c[b["Shift-"+f+"Enter"]="insertLineBefore"]=function(a){j(a,true)};function k(b,c){var e=c.ch,f=e,g=b.getLine(c.line);while(e&&a.isWordChar(g.charAt(e-1)))--e;while(f<g.length&&a.isWordChar(g.charAt(f)))++f;return{from:d(c.line,e),to:d(c.line,f),word:g.slice(e,f)}}c[b[f+"D"]="selectNextOccurrence"]=function(b){var c=b.getCursor("from"),e=b.getCursor("to");var f=b.state.sublimeFindFullWord==b.doc.sel;if(a.cmpPos(c,e)==0){var g=k(b,c);if(!g.word)return;b.setSelection(g.from,g.to);f=true}else{var h=b.getRange(c,e);var i=f?new RegExp("\\b"+h+"\\b"):h;var j=b.getSearchCursor(i,e);if(j.findNext()){b.addSelection(j.from(),j.to())}else{j=b.getSearchCursor(i,d(b.firstLine(),0));if(j.findNext())b.addSelection(j.from(),j.to())}}if(f)b.state.sublimeFindFullWord=b.doc.sel};var l="(){}[]";function m(a){var b=a.getCursor(),c=a.scanForBracket(b,-1);if(!c)return;for(;;){var e=a.scanForBracket(b,1);if(!e)return;if(e.ch==l.charAt(l.indexOf(c.ch)+1)){a.setSelection(d(c.pos.line,c.pos.ch+1),e.pos,false);return true}b=d(e.pos.line,e.pos.ch+1)}}c[b["Shift-"+f+"Space"]="selectScope"]=function(a){m(a)||a.execCommand("selectAll")};c[b["Shift-"+f+"M"]="selectBetweenBrackets"]=function(b){if(!m(b))return a.Pass};c[b[f+"M"]="goToBracket"]=function(b){b.extendSelectionsBy(function(c){var e=b.scanForBracket(c.head,1);if(e&&a.cmpPos(e.pos,c.head)!=0)return e.pos;var f=b.scanForBracket(c.head,-1);return f&&d(f.pos.line,f.pos.ch+1)||c.head})};var n=e?"Cmd-Ctrl-":"Shift-Ctrl-";c[b[n+"Up"]="swapLineUp"]=function(a){var b=a.listSelections(),c=[],e=a.firstLine()-1,f=[];for(var g=0;g<b.length;g++){var h=b[g],i=h.from().line-1,j=h.to().line;f.push({anchor:d(h.anchor.line-1,h.anchor.ch),head:d(h.head.line-1,h.head.ch)});if(h.to().ch==0&&!h.empty())--j;if(i>e)c.push(i,j);else if(c.length)c[c.length-1]=j;e=j}a.operation(function(){for(var b=0;b<c.length;b+=2){var e=c[b],g=c[b+1];var h=a.getLine(e);a.replaceRange("",d(e,0),d(e+1,0),"+swapLine");if(g>a.lastLine())a.replaceRange("\n"+h,d(a.lastLine()),null,"+swapLine");else a.replaceRange(h+"\n",d(g,0),null,"+swapLine")}a.setSelections(f);a.scrollIntoView()})};c[b[n+"Down"]="swapLineDown"]=function(a){var b=a.listSelections(),c=[],e=a.lastLine()+1;for(var f=b.length-1;f>=0;f--){var g=b[f],h=g.to().line+1,i=g.from().line;if(g.to().ch==0&&!g.empty())h--;if(h<e)c.push(h,i);else if(c.length)c[c.length-1]=i;e=i}a.operation(function(){for(var b=c.length-2;b>=0;b-=2){var e=c[b],f=c[b+1];var g=a.getLine(e);if(e==a.lastLine())a.replaceRange("",d(e-1),d(e),"+swapLine");else a.replaceRange("",d(e,0),d(e+1,0),"+swapLine");a.replaceRange(g+"\n",d(f,0),null,"+swapLine")}a.scrollIntoView()})};b[f+"/"]="toggleComment";c[b[f+"J"]="joinLines"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e],g=f.from();var h=g.line,i=f.to().line;while(e<b.length-1&&b[e+1].from().line==i)i=b[++e].to().line;c.push({start:h,end:i,anchor:!f.empty()&&g})}a.operation(function(){var b=0,e=[];for(var f=0;f<c.length;f++){var g=c[f];var h=g.anchor&&d(g.anchor.line-b,g.anchor.ch),i;for(var j=g.start;j<=g.end;j++){var k=j-b;if(j==g.end)i=d(k,a.getLine(k).length+1);if(k<a.lastLine()){a.replaceRange(" ",d(k),d(k+1,/^\s*/.exec(a.getLine(k+1))[0].length));++b}}e.push({anchor:h||i,head:i})}a.setSelections(e,0)})};c[b["Shift-"+f+"D"]="duplicateLine"]=function(a){a.operation(function(){var b=a.listSelections().length;for(var c=0;c<b;c++){var e=a.listSelections()[c];if(e.empty())a.replaceRange(a.getLine(e.head.line)+"\n",d(e.head.line,0));else a.replaceRange(a.getRange(e.from(),e.to()),e.from())}a.scrollIntoView()})};b[f+"T"]="transposeChars";function o(a,b){var c=a.listSelections(),e=[],f;for(var g=0;g<c.length;g++){var h=c[g];if(h.empty())continue;var i=h.from().line,j=h.to().line;while(g<c.length-1&&c[g+1].from().line==j)j=h[++g].to().line;e.push(i,j)}if(e.length)f=true;else e.push(a.firstLine(),a.lastLine());a.operation(function(){var c=[];for(var g=0;g<e.length;g+=2){var h=e[g],i=e[g+1];var j=d(h,0),k=d(i);var l=a.getRange(j,k,false);if(b)l.sort();else l.sort(function(a,b){var c=a.toUpperCase(),d=b.toUpperCase();if(c!=d){a=c;b=d}return a<b?-1:a==b?0:1});a.replaceRange(l,j,k);if(f)c.push({anchor:j,head:k})}if(f)a.setSelections(c,0)})}c[b["F9"]="sortLines"]=function(a){o(a,true)};c[b[f+"F9"]="sortLinesInsensitive"]=function(a){o(a,false)};c[b["F2"]="nextBookmark"]=function(a){var b=a.state.sublimeBookmarks;if(b)while(b.length){var c=b.shift();var d=c.find();if(d){b.push(c);return a.setSelection(d.from,d.to)}}};c[b["Shift-F2"]="prevBookmark"]=function(a){var b=a.state.sublimeBookmarks;if(b)while(b.length){b.unshift(b.pop());var c=b[b.length-1].find();if(!c)b.pop();else return a.setSelection(c.from,c.to)}};c[b[f+"F2"]="toggleBookmark"]=function(a){var b=a.listSelections();var c=a.state.sublimeBookmarks||(a.state.sublimeBookmarks=[]);for(var d=0;d<b.length;d++){var e=b[d].from(),f=b[d].to();var g=a.findMarks(e,f);for(var h=0;h<g.length;h++){if(g[h].sublimeBookmark){g[h].clear();for(var i=0;i<c.length;i++)if(c[i]==g[h])c.splice(i--,1);break}}if(h==g.length)c.push(a.markText(e,f,{sublimeBookmark:true,clearWhenEmpty:false}))}};c[b["Shift-"+f+"F2"]="clearBookmarks"]=function(a){var b=a.state.sublimeBookmarks;if(b)for(var c=0;c<b.length;c++)b[c].clear();b.length=0};c[b["Alt-F2"]="selectBookmarks"]=function(a){var b=a.state.sublimeBookmarks,c=[];if(b)for(var d=0;d<b.length;d++){var e=b[d].find();if(!e)b.splice(d--,0);else c.push({anchor:e.from,head:e.to})}if(c.length)a.setSelections(c,0)};b["Alt-Q"]="wrapLines";var p=f+"K ";function q(b,c){b.operation(function(){var d=b.listSelections(),e=[],f=[];for(var g=0;g<d.length;g++){var h=d[g];if(h.empty()){e.push(g);f.push("")}else f.push(c(b.getRange(h.from(),h.to())))}b.replaceSelections(f,"around","case");for(var g=e.length-1,i;g>=0;g--){var h=d[e[g]];if(i&&a.cmpPos(h.head,i)>0)continue;var j=k(b,h.head);i=j.from;b.replaceRange(c(j.word),j.from,j.to)}})}b[p+f+"Backspace"]="delLineLeft";c[b["Backspace"]="smartBackspace"]=function(b){if(b.somethingSelected())return a.Pass;var c=b.getCursor();var d=b.getRange({line:c.line,ch:0},c);var e=a.countColumn(d,null,b.getOption("tabSize"));if(d&&!/\S/.test(d)&&e%b.getOption("indentUnit")==0)return b.indentSelection("subtract");else return a.Pass};c[b[p+f+"K"]="delLineRight"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=b.length-1;c>=0;c--)a.replaceRange("",b[c].anchor,d(b[c].to().line),"+delete");a.scrollIntoView()})};c[b[p+f+"U"]="upcaseAtCursor"]=function(a){q(a,function(a){return a.toUpperCase()})};c[b[p+f+"L"]="downcaseAtCursor"]=function(a){q(a,function(a){return a.toLowerCase()})};c[b[p+f+"Space"]="setSublimeMark"]=function(a){if(a.state.sublimeMark)a.state.sublimeMark.clear();a.state.sublimeMark=a.setBookmark(a.getCursor())};c[b[p+f+"A"]="selectToSublimeMark"]=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();if(b)a.setSelection(a.getCursor(),b)};c[b[p+f+"W"]="deleteToSublimeMark"]=function(b){var c=b.state.sublimeMark&&b.state.sublimeMark.find();if(c){var d=b.getCursor(),e=c;if(a.cmpPos(d,e)>0){var f=e;e=d;d=f}b.state.sublimeKilled=b.getRange(d,e);b.replaceRange("",d,e)}};c[b[p+f+"X"]="swapWithSublimeMark"]=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();if(b){a.state.sublimeMark.clear();a.state.sublimeMark=a.setBookmark(a.getCursor());a.setCursor(b)}};c[b[p+f+"Y"]="sublimeYank"]=function(a){if(a.state.sublimeKilled!=null)a.replaceSelection(a.state.sublimeKilled,null,"paste")};b[p+f+"G"]="clearBookmarks";c[b[p+f+"C"]="showInCenter"]=function(a){var b=a.cursorCoords(null,"local");a.scrollTo(null,(b.top+b.bottom)/2-a.getScrollInfo().clientHeight/2)};c[b["Shift-Alt-Up"]="selectLinesUpward"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=0;c<b.length;c++){var e=b[c];if(e.head.line>a.firstLine())a.addSelection(d(e.head.line-1,e.head.ch))}})};c[b["Shift-Alt-Down"]="selectLinesDownward"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=0;c<b.length;c++){var e=b[c];if(e.head.line<a.lastLine())a.addSelection(d(e.head.line+1,e.head.ch))}})};function r(b){var c=b.getCursor("from"),d=b.getCursor("to");if(a.cmpPos(c,d)==0){var e=k(b,c);if(!e.word)return;c=e.from;d=e.to}return{from:c,to:d,query:b.getRange(c,d),word:e}}function s(a,b){var c=r(a);if(!c)return;var e=c.query;var f=a.getSearchCursor(e,b?c.to:c.from);if(b?f.findNext():f.findPrevious()){a.setSelection(f.from(),f.to())}else{f=a.getSearchCursor(e,b?d(a.firstLine(),0):a.clipPos(d(a.lastLine())));if(b?f.findNext():f.findPrevious())a.setSelection(f.from(),f.to());else if(c.word)a.setSelection(c.from,c.to)}}c[b[f+"F3"]="findUnder"]=function(a){s(a,true)};c[b["Shift-"+f+"F3"]="findUnderPrevious"]=function(a){s(a,false)};c[b["Alt-F3"]="findAllUnder"]=function(a){var b=r(a);if(!b)return;var c=a.getSearchCursor(b.query);var d=[];var e=-1;while(c.findNext()){d.push({anchor:c.from(),head:c.to()});if(c.from().line<=b.from.line&&c.from().ch<=b.from.ch)e++}a.setSelections(d,e)};b["Shift-"+f+"["]="fold";b["Shift-"+f+"]"]="unfold";b[p+f+"0"]=b[p+f+"j"]="unfoldAll";b[f+"I"]="findIncremental";b["Shift-"+f+"I"]="findIncrementalReverse";b[f+"H"]="replace";b["F3"]="findNext";b["Shift-F3"]="findPrev";a.normalizeKeyMap(b)});
//# sourceMappingURL=sublime.min.js.map