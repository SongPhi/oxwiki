(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a);else a(CodeMirror)})(function(a){"use strict";var b=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var c=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var d=a.Pos;var e=function(){function e(b){b.setOption("disableInput",true);b.setOption("showCursorWhenSelecting",false);a.signal(b,"vim-mode-change",{mode:"normal"});b.on("cursorActivity",Cb);K(b);a.on(b.getInputField(),"paste",m(b))}function f(b){b.setOption("disableInput",false);b.off("cursorActivity",Cb);a.off(b.getInputField(),"paste",m(b));b.state.vim=null}function g(b,c){if(this==a.keyMap.vim)a.rmClass(b.getWrapperElement(),"cm-fat-cursor");if(!c||c.attach!=h)f(b,false)}function h(b,c){if(this==a.keyMap.vim)a.addClass(b.getWrapperElement(),"cm-fat-cursor");if(!c||c.attach!=h)e(b)}a.defineOption("vimMode",false,function(b,c,d){if(c&&b.getOption("keyMap")!="vim")b.setOption("keyMap","vim");else if(!c&&d!=a.Init&&/^vim/.test(b.getOption("keyMap")))b.setOption("keyMap","default")});function i(b,c){if(!c){return undefined}var d=l(b);if(!d){return false}var e=a.Vim.findKey(c,d);if(typeof e=="function"){a.signal(c,"vim-keypress",d)}return e}var j={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var k={Enter:"CR",Backspace:"BS",Delete:"Del"};function l(a){if(a.charAt(0)=="'"){return a.charAt(1)}var b=a.split("-");if(/-$/.test(a)){b.splice(-2,2,"-")}var c=b[b.length-1];if(b.length==1&&b[0].length==1){return false}else if(b.length==2&&b[0]=="Shift"&&c.length==1){return false}var d=false;for(var e=0;e<b.length;e++){var f=b[e];if(f in j){b[e]=j[f]}else{d=true}if(f in k){b[e]=k[f]}}if(!d){return false}if(A(c)){b[b.length-1]=c.toLowerCase()}return"<"+b.join("-")+">"}function m(a){var b=a.state.vim;if(!b.onPasteFn){b.onPasteFn=function(){if(!b.insertMode){a.setCursor(da(a.getCursor(),0,1));_.enterInsertMode(a,{},b)}}}return b.onPasteFn}var n=/[\d]/;var o=[a.isWordChar,function(b){return b&&!a.isWordChar(b)&&!/\s/.test(b)}],p=[function(a){return/\S/.test(a)}];function q(a,b){var c=[];for(var d=a;d<a+b;d++){c.push(String.fromCharCode(d))}return c}var r=q(65,26);var s=q(97,26);var t=q(48,10);var u=[].concat(r,s,t,["<",">"]);var v=[].concat(r,s,t,["-",'"',".",":","/"]);function w(a,b){return b>=a.firstLine()&&b<=a.lastLine()}function x(a){return/^[a-z]$/.test(a)}function y(a){return"()[]{}".indexOf(a)!=-1}function z(a){return n.test(a)}function A(a){return/^[A-Z]$/.test(a)}function B(a){return/^\s*$/.test(a)}function C(a,b){for(var c=0;c<b.length;c++){if(b[c]==a){return true}}return false}var D={};function E(a,b,c,d,e){if(b===undefined&&!e){throw Error("defaultValue is required unless callback is provided")}if(!c){c="string"}D[a]={type:c,defaultValue:b,callback:e};if(d){for(var f=0;f<d.length;f++){D[d[f]]=D[a]}}if(b){F(a,b)}}function F(a,b,c,d){var e=D[a];d=d||{};var f=d.scope;if(!e){throw Error("Unknown option: "+a)}if(e.type=="boolean"){if(b&&b!==true){throw Error("Invalid argument: "+a+"="+b)}else if(b!==false){b=true}}if(e.callback){if(f!=="local"){e.callback(b,undefined)}if(f!=="global"&&c){e.callback(b,c)}}else{if(f!=="local"){e.value=e.type=="boolean"?!!b:b}if(f!=="global"&&c){c.state.vim.options[a]={value:b}}}}function G(a,b,c){var d=D[a];c=c||{};var e=c.scope;if(!d){throw Error("Unknown option: "+a)}if(d.callback){var f=b&&d.callback(undefined,b);if(e!=="global"&&f!==undefined){return f}if(e!=="local"){return d.callback()}return}else{var f=e!=="global"&&(b&&b.state.vim.options[a]);return(f||e!=="local"&&d||{}).value}}E("filetype",undefined,"string",["ft"],function(a,b){if(b===undefined){return}if(a===undefined){var c=b.getOption("mode");return c=="null"?"":c}else{var c=a==""?"null":a;b.setOption("mode",c)}});var H=function(){var a=100;var b=-1;var c=0;var d=0;var e=new Array(a);function f(f,g,h){var i=b%a;var j=e[i];function k(c){var d=++b%a;var g=e[d];if(g){g.clear()}e[d]=f.setBookmark(c)}if(j){var l=j.find();if(l&&!ka(l,g)){k(g)}}else{k(g)}k(h);c=b;d=b-a+1;if(d<0){d=0}}function g(f,g){b+=g;if(b>c){b=c}else if(b<d){b=d}var h=e[(a+b)%a];if(h&&!h.find()){var i=g>0?1:-1;var j;var k=f.getCursor();do{b+=i;h=e[(a+b)%a];if(h&&(j=h.find())&&!ka(k,j)){break}}while(b<c&&b>d)}return h}return{cachedCursor:undefined,add:f,move:g}};var I=function(a){if(a){return{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function J(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=I()}J.prototype={exitMacroRecordMode:function(){var a=L.macroModeState;if(a.onRecordingDone){a.onRecordingDone()}a.onRecordingDone=undefined;a.isRecording=false},enterMacroRecordMode:function(a,b){var c=L.registerController.getRegister(b);if(c){c.clear();this.latestRegister=b;if(a.openDialog){this.onRecordingDone=a.openDialog("(recording)["+b+"]",null,{bottom:true})}this.isRecording=true}}};function K(a){if(!a.state.vim){a.state.vim={inputState:new P,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return a.state.vim}var L;function M(){L={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:H(),macroModeState:new J,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new T({}),searchHistoryController:new U({}),exCommandHistoryController:new U({})};for(var a in D){var b=D[a];b.value=b.defaultValue}}var N;var O={buildKeyMap:function(){},getRegisterController:function(){return L.registerController},resetVimGlobalState_:M,getVimGlobalState_:function(){return L},maybeInitVimState_:K,suppressErrorLogging:false,InsertModeKey:Fb,map:function(a,b,c){sb.map(a,b,c)},setOption:F,getOption:G,defineOption:E,defineEx:function(a,b,c){if(!b){b=a}else if(a.indexOf(b)!==0){throw new Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered')}rb[a]=c;sb.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(a,b,c){var d=this.findKey(a,b,c);if(typeof d==="function"){return d()}},findKey:function(c,d,e){var f=K(c);function g(){var a=L.macroModeState;if(a.isRecording){if(d=="q"){a.exitMacroRecordMode();Q(c);return true}if(e!="mapping"){yb(a,d)}}}function h(){if(d=="<Esc>"){Q(c);if(f.visualMode){Ca(c)}else if(f.insertMode){ub(c)}return true}}function i(b){var e;while(b){e=/<\w+-.+?>|<\w+>|./.exec(b);d=e[0];b=b.substring(e.index+d.length);a.Vim.handleKey(c,d,"mapping")}}function j(){if(h()){return true}var a=f.inputState.keyBuffer=f.inputState.keyBuffer+d;var e=d.length==1;var g=V.matchCommand(a,b,f.inputState,"insert");while(a.length>1&&g.type!="full"){var a=f.inputState.keyBuffer=a.slice(1);var i=V.matchCommand(a,b,f.inputState,"insert");if(i.type!="none"){g=i}}if(g.type=="none"){Q(c);return false}else if(g.type=="partial"){if(N){window.clearTimeout(N)}N=window.setTimeout(function(){if(f.insertMode&&f.inputState.keyBuffer){Q(c)}},G("insertModeEscKeysTimeout"));return!e}if(N){window.clearTimeout(N)}if(e){var j=c.getCursor();c.replaceRange("",da(j,0,-(a.length-1)),j,"+input")}Q(c);return g.command}function k(){if(g()||h()){return true}var a=f.inputState.keyBuffer=f.inputState.keyBuffer+d;if(/^[1-9]\d*$/.test(a)){return true}var e=/^(\d*)(.*)$/.exec(a);if(!e){Q(c);return false}var i=f.visualMode?"visual":"normal";var j=V.matchCommand(e[2]||e[1],b,f.inputState,i);if(j.type=="none"){Q(c);return false}else if(j.type=="partial"){return true}f.inputState.keyBuffer="";var e=/^(\d*)(.*)$/.exec(a);if(e[1]&&e[1]!="0"){f.inputState.pushRepeatDigit(e[1])}return j.command}var l;if(f.insertMode){l=j()}else{l=k()}if(l===false){return undefined}else if(l===true){return function(){}}else{return function(){return c.operation(function(){c.curOp.isVimOp=true;try{if(l.type=="keyToKey"){i(l.toKeys)}else{V.processCommand(c,f,l)}}catch(b){c.state.vim=undefined;K(c);if(!a.Vim.suppressErrorLogging){console["log"](b)}throw b}return true})}}},handleEx:function(a,b){sb.processCommand(a,b)},defineMotion:X,defineAction:aa,defineOperator:$,mapCommand:wb,_mapCommand:vb,defineRegister:S,exitVisualMode:Ca,exitInsertMode:ub};function P(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}P.prototype.pushRepeatDigit=function(a){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(a)}else{this.motionRepeat=this.motionRepeat.concat(a)}};P.prototype.getRepeat=function(){var a=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){a=1;if(this.prefixRepeat.length>0){a*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){a*=parseInt(this.motionRepeat.join(""),10)}}return a};function Q(b,c){b.state.vim.inputState=new P;a.signal(b,"vim-command-done",c)}function R(a,b,c){this.clear();this.keyBuffer=[a||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!b;this.blockwise=!!c}R.prototype={setText:function(a,b,c){this.keyBuffer=[a||""];this.linewise=!!b;this.blockwise=!!c},pushText:function(a,b){if(b){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(a)},pushInsertModeChanges:function(a){this.insertModeChanges.push(I(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function S(a,b){var c=L.registerController.registers[a];if(!a||a.length!=1){throw Error("Register name must be 1 character")}if(c[a]){throw Error("Register already defined "+a)}c[a]=b;v.push(a)}function T(a){this.registers=a;this.unnamedRegister=a['"']=new R;a["."]=new R;a[":"]=new R;a["/"]=new R}T.prototype={pushText:function(a,b,c,d,e){if(d&&c.charAt(0)=="\n"){c=c.slice(1)+"\n"}if(d&&c.charAt(c.length-1)!=="\n"){c+="\n"}var f=this.isValidRegister(a)?this.getRegister(a):null;if(!f){switch(b){case"yank":this.registers["0"]=new R(c,d,e);break;case"delete":case"change":if(c.indexOf("\n")==-1){this.registers["-"]=new R(c,d)}else{this.shiftNumericRegisters_();this.registers["1"]=new R(c,d)}break}this.unnamedRegister.setText(c,d,e);return}var g=A(a);if(g){f.pushText(c,d)}else{f.setText(c,d,e)}this.unnamedRegister.setText(f.toString(),d)},getRegister:function(a){if(!this.isValidRegister(a)){return this.unnamedRegister}a=a.toLowerCase();if(!this.registers[a]){this.registers[a]=new R}return this.registers[a]},isValidRegister:function(a){return a&&C(a,v)},shiftNumericRegisters_:function(){for(var a=9;a>=2;a--){this.registers[a]=this.getRegister(""+(a-1))}}};function U(){this.historyBuffer=[];this.iterator;this.initialPrefix=null}U.prototype={nextMatch:function(a,b){var c=this.historyBuffer;var d=b?-1:1;if(this.initialPrefix===null)this.initialPrefix=a;for(var e=this.iterator+d;b?e>=0:e<c.length;e+=d){var f=c[e];for(var g=0;g<=f.length;g++){if(this.initialPrefix==f.substring(0,g)){this.iterator=e;return f}}}if(e>=c.length){this.iterator=c.length;return this.initialPrefix}if(e<0)return a},pushInput:function(a){var b=this.historyBuffer.indexOf(a);if(b>-1)this.historyBuffer.splice(b,1);if(a.length)this.historyBuffer.push(a)},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var V={matchCommand:function(a,b,c,d){var e=fa(a,b,d,c);if(!e.full&&!e.partial){return{type:"none"}}else if(!e.full&&e.partial){return{type:"partial"}}var f;for(var g=0;g<e.full.length;g++){var h=e.full[g];if(!f){f=h}}if(f.keys.slice(-11)=="<character>"){c.selectedCharacter=ha(a)}return{type:"full",command:f}},processCommand:function(a,b,c){b.inputState.repeatOverride=c.repeatOverride;switch(c.type){case"motion":this.processMotion(a,b,c);break;case"operator":this.processOperator(a,b,c);break;case"operatorMotion":this.processOperatorMotion(a,b,c);break;case"action":this.processAction(a,b,c);break;case"search":this.processSearch(a,b,c);break;case"ex":case"keyToEx":this.processEx(a,b,c);break;default:break}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=ca(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;if(d.operator){if(d.operator==c.operator){d.motion="expandToLine";d.motionArgs={linewise:true};this.evalInput(a,b);return}else{Q(a)}}d.operator=c.operator;d.operatorArgs=ca(c.operatorArgs);if(b.visualMode){this.evalInput(a,b)}},processOperatorMotion:function(a,b,c){var d=b.visualMode;var e=ca(c.operatorMotionArgs);if(e){if(d&&e.visualLine){b.visualLine=true}}this.processOperator(a,b,c);if(!d){this.processMotion(a,b,c)}},processAction:function(a,b,c){var d=b.inputState;var e=d.getRepeat();var f=!!e;var g=ca(c.actionArgs)||{};if(d.selectedCharacter){g.selectedCharacter=d.selectedCharacter}if(c.operator){this.processOperator(a,b,c)}if(c.motion){this.processMotion(a,b,c)}if(c.motion||c.operator){this.evalInput(a,b)}g.repeat=e||1;g.repeatIsExplicit=f;g.registerName=d.registerName;Q(a);b.lastMotion=null;if(c.isEdit){this.recordLastEdit(b,d,c)}_[c.action](a,g,b)},processSearch:function(b,c,d){if(!b.getSearchCursor){return}var e=d.searchArgs.forward;var f=d.searchArgs.wholeWordOnly;Wa(b).setReversed(!e);var g=e?"/":"?";var h=Wa(b).getQuery();var i=b.getScrollInfo();function j(a,e,f){L.searchHistoryController.pushInput(a);L.searchHistoryController.reset();try{jb(b,a,e,f)}catch(g){eb(b,"Invalid regex: "+a);Q(b);return}V.processMotion(b,c,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:d.searchArgs.toJumplist}})}function k(a){b.scrollTo(i.left,i.top);j(a,true,true);var c=L.macroModeState;if(c.isRecording){Ab(c,a)}}function l(c,d,f){var g=a.keyName(c),h;if(g=="Up"||g=="Down"){h=g=="Up"?true:false;d=L.searchHistoryController.nextMatch(d,h)||"";f(d)}else{if(g!="Left"&&g!="Right"&&g!="Ctrl"&&g!="Alt"&&g!="Shift")L.searchHistoryController.reset()}var j;try{j=jb(b,d,true,true)}catch(c){}if(j){b.scrollIntoView(mb(b,!e,j),30)}else{nb(b);b.scrollTo(i.left,i.top)}}function m(c,d,e){var f=a.keyName(c);if(f=="Esc"||f=="Ctrl-C"||f=="Ctrl-["||f=="Backspace"&&d==""){L.searchHistoryController.pushInput(d);L.searchHistoryController.reset();jb(b,h);nb(b);b.scrollTo(i.left,i.top);a.e_stop(c);Q(b);e();b.focus()}else if(f=="Ctrl-U"){a.e_stop(c);e("")}}switch(d.searchArgs.querySrc){case"prompt":var n=L.macroModeState;if(n.isPlaying){var o=n.replaySearchQueries.shift();j(o,true,false)}else{hb(b,{onClose:k,prefix:g,desc:gb,onKeyUp:l,onKeyDown:m})}break;case"wordUnderCursor":var p=Ga(b,false,true,false,true);var q=true;if(!p){p=Ga(b,false,true,false,false);q=false}if(!p){return}var o=b.getLine(p.start.line).substring(p.start.ch,p.end.ch);if(q&&f){o="\\b"+o+"\\b"}else{o=ra(o)}L.jumpList.cachedCursor=b.getCursor();b.setCursor(p.start);j(o,true,false);break}},processEx:function(b,c,d){function e(a){L.exCommandHistoryController.pushInput(a);L.exCommandHistoryController.reset();sb.processCommand(b,a)}function f(c,d,e){var f=a.keyName(c),g;if(f=="Esc"||f=="Ctrl-C"||f=="Ctrl-["||f=="Backspace"&&d==""){L.exCommandHistoryController.pushInput(d);L.exCommandHistoryController.reset();a.e_stop(c);Q(b);e();b.focus()}if(f=="Up"||f=="Down"){g=f=="Up"?true:false;d=L.exCommandHistoryController.nextMatch(d,g)||"";e(d)}else if(f=="Ctrl-U"){a.e_stop(c);e("")}else{if(f!="Left"&&f!="Right"&&f!="Ctrl"&&f!="Alt"&&f!="Shift")L.exCommandHistoryController.reset()}}if(d.type=="keyToEx"){sb.processCommand(b,d.exArgs.input)}else{if(c.visualMode){hb(b,{onClose:e,prefix:":",value:"'<,'>",onKeyDown:f})}else{hb(b,{onClose:e,prefix:":",onKeyDown:f})}}},evalInput:function(a,b){var c=b.inputState;var e=c.motion;var f=c.motionArgs||{};var g=c.operator;var h=c.operatorArgs||{};var i=c.registerName;var j=b.sel;var k=ja(b.visualMode?ba(a,j.head):a.getCursor("head"));var l=ja(b.visualMode?ba(a,j.anchor):a.getCursor("anchor"));var m=ja(k);var n=ja(l);var o,p;var q;if(g){this.recordLastEdit(b,c)}if(c.repeatOverride!==undefined){q=c.repeatOverride}else{q=c.getRepeat()}if(q>0&&f.explicitRepeat){f.repeatIsExplicit=true}else if(f.noRepeat||!f.explicitRepeat&&q===0){q=1;f.repeatIsExplicit=false}if(c.selectedCharacter){f.selectedCharacter=h.selectedCharacter=c.selectedCharacter}f.repeat=q;Q(a);if(e){var r=W[e](a,k,f,b);b.lastMotion=W[e];if(!r){return}if(f.toJumplist){var s=L.jumpList;var t=s.cachedCursor;if(t){Ha(a,t,r);delete s.cachedCursor}else{Ha(a,k,r)}}if(r instanceof Array){p=r[0];o=r[1]}else{o=r}if(!o){o=ja(k)}if(b.visualMode){if(!(b.visualBlock&&o.ch===Infinity)){o=ba(a,o,b.visualBlock)}if(p){p=ba(a,p,true)}p=p||n;j.anchor=p;j.head=o;za(a);Qa(a,b,"<",la(p,o)?p:o);Qa(a,b,">",la(p,o)?o:p)}else if(!g){o=ba(a,o);a.setCursor(o.line,o.ch)}}if(g){if(h.lastSel){p=n;var u=h.lastSel;var v=Math.abs(u.head.line-u.anchor.line);var w=Math.abs(u.head.ch-u.anchor.ch);if(u.visualLine){o=d(n.line+v,n.ch)}else if(u.visualBlock){o=d(n.line+v,n.ch+w)}else if(u.head.line==u.anchor.line){o=d(n.line,n.ch+w)}else{o=d(n.line+v,n.ch)}b.visualMode=true;b.visualLine=u.visualLine;b.visualBlock=u.visualBlock;j=b.sel={anchor:p,head:o};za(a)}else if(b.visualMode){h.lastSel={anchor:ja(j.anchor),head:ja(j.head),visualBlock:b.visualBlock,visualLine:b.visualLine}}var x,y,z,A;var B;if(b.visualMode){x=ma(j.head,j.anchor);y=na(j.head,j.anchor);z=b.visualLine||h.linewise;A=b.visualBlock?"block":z?"line":"char";B=Aa(a,{anchor:x,head:y},A);if(z){var C=B.ranges;if(A=="block"){for(var D=0;D<C.length;D++){C[D].head.ch=pa(a,C[D].head.line)}}else if(A=="line"){C[0].head=d(C[0].head.line+1,0)}}}else{x=ja(p||n);y=ja(o||m);if(la(y,x)){var E=x;x=y;y=E}z=f.linewise||h.linewise;if(z){Ea(a,x,y)}else if(f.forward){Da(a,x,y)}A="char";var F=!f.inclusive||z;B=Aa(a,{anchor:x,head:y},A,F)}a.setSelections(B.ranges,B.primary);b.lastMotion=null;h.repeat=q;h.registerName=i;h.linewise=z;var G=Z[g](a,h,B.ranges,n,o);if(b.visualMode){Ca(a,G!=null)}if(G){a.setCursor(G)}}},recordLastEdit:function(a,b,c){var d=L.macroModeState;if(d.isPlaying){return}a.lastEditInputState=b;a.lastEditActionCommand=c;d.lastInsertModeChanges.changes=[];d.lastInsertModeChanges.expectCursorActivityForChange=false}};var W={moveToTopLine:function(a,b,c){var e=pb(a).top+c.repeat-1;return d(e,Fa(a.getLine(e)))},moveToMiddleLine:function(a){var b=pb(a);var c=Math.floor((b.top+b.bottom)*.5);return d(c,Fa(a.getLine(c)))},moveToBottomLine:function(a,b,c){var e=pb(a).bottom-c.repeat+1;return d(e,Fa(a.getLine(e)))},expandToLine:function(a,b,c){var e=b;return d(e.line+c.repeat-1,Infinity)},findNext:function(a,b,c){var d=Wa(a);var e=d.getQuery();if(!e){return}var f=!c.forward;f=d.isReversed()?!f:f;lb(a,e);return mb(a,f,e,c.repeat)},goToMark:function(a,b,c,d){var e=d.marks[c.selectedCharacter];if(e){var f=e.find();return c.linewise?{line:f.line,ch:Fa(a.getLine(f.line))}:f}return null},moveToOtherHighlightedEnd:function(a,b,c,e){if(e.visualBlock&&c.sameLine){var f=e.sel;return[ba(a,d(f.anchor.line,f.head.ch)),ba(a,d(f.head.line,f.anchor.ch))]}else{return[e.sel.head,e.sel.anchor]}},jumpToMark:function(a,b,c,e){var f=b;for(var g=0;g<c.repeat;g++){
var h=f;for(var i in e.marks){if(!x(i)){continue}var j=e.marks[i].find();var k=c.forward?la(j,h):la(h,j);if(k){continue}if(c.linewise&&j.line==h.line){continue}var l=ka(h,f);var m=c.forward?oa(h,j,f):oa(f,j,h);if(l||m){f=j}}}if(c.linewise){f=d(f.line,Fa(a.getLine(f.line)))}return f},moveByCharacters:function(a,b,c){var e=b;var f=c.repeat;var g=c.forward?e.ch+f:e.ch-f;return d(e.line,g)},moveByLines:function(a,b,c,e){var f=b;var g=f.ch;switch(e.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:g=e.lastHPos;break;default:e.lastHPos=g}var h=c.repeat+(c.repeatOffset||0);var i=c.forward?f.line+h:f.line-h;var j=a.firstLine();var k=a.lastLine();if(i<j&&f.line==j||i>k&&f.line==k){return}if(c.toFirstChar){g=Fa(a.getLine(i));e.lastHPos=g}e.lastHSPos=a.charCoords(d(i,g),"div").left;return d(i,g)},moveByDisplayLines:function(a,b,c,e){var f=b;switch(e.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:e.lastHSPos=a.charCoords(f,"div").left}var g=c.repeat;var h=a.findPosV(f,c.forward?g:-g,"line",e.lastHSPos);if(h.hitSide){if(c.forward){var i=a.charCoords(h,"div");var j={top:i.top+8,left:e.lastHSPos};var h=a.coordsChar(j,"div")}else{var k=a.charCoords(d(a.firstLine(),0),"div");k.left=e.lastHSPos;h=a.coordsChar(k,"div")}}e.lastHPos=h.ch;return h},moveByPage:function(a,b,c){var d=b;var e=c.repeat;return a.findPosV(d,c.forward?e:-e,"page")},moveByParagraph:function(a,b,c){var d=c.forward?1:-1;return Sa(a,b,c.repeat,d)},moveByScroll:function(a,b,c,d){var e=a.getScrollInfo();var f=null;var g=c.repeat;if(!g){g=e.clientHeight/(2*a.defaultTextHeight())}var h=a.charCoords(b,"local");c.repeat=g;var f=W.moveByDisplayLines(a,b,c,d);if(!f){return null}var i=a.charCoords(f,"local");a.scrollTo(null,e.top+i.top-h.top);return f},moveByWords:function(a,b,c){return Na(a,b,c.repeat,!!c.forward,!!c.wordEnd,!!c.bigWord)},moveTillCharacter:function(a,b,c){var d=c.repeat;var e=Oa(a,d,c.forward,c.selectedCharacter);var f=c.forward?-1:1;Ia(f,c);if(!e)return null;e.ch+=f;return e},moveToCharacter:function(a,b,c){var d=c.repeat;Ia(0,c);return Oa(a,d,c.forward,c.selectedCharacter)||b},moveToSymbol:function(a,b,c){var d=c.repeat;return La(a,d,c.forward,c.selectedCharacter)||b},moveToColumn:function(a,b,c,d){var e=c.repeat;d.lastHPos=e-1;d.lastHSPos=a.charCoords(b,"div").left;return Pa(a,e)},moveToEol:function(a,b,c,e){var f=b;e.lastHPos=Infinity;var g=d(f.line+c.repeat-1,Infinity);var h=a.clipPos(g);h.ch--;e.lastHSPos=a.charCoords(h,"div").left;return g},moveToFirstNonWhiteSpaceCharacter:function(a,b){var c=b;return d(c.line,Fa(a.getLine(c.line)))},moveToMatchedSymbol:function(a,b){var c=b;var e=c.line;var f=c.ch;var g=a.getLine(e);var h;do{h=g.charAt(f++);if(h&&y(h)){var i=a.getTokenTypeAt(d(e,f));if(i!=="string"&&i!=="comment"){break}}}while(h);if(h){var j=a.findMatchingBracket(d(e,f));return j.to}else{return c}},moveToStartOfLine:function(a,b){return d(b.line,0)},moveToLineOrEdgeOfDocument:function(a,b,c){var e=c.forward?a.lastLine():a.firstLine();if(c.repeatIsExplicit){e=c.repeat-a.getOption("firstLineNumber")}return d(e,Fa(a.getLine(e)))},textObjectManipulation:function(a,b,c,d){var e={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var f={"'":true,'"':true};var g=c.selectedCharacter;if(g=="b"){g="("}else if(g=="B"){g="{"}var h=!c.textObjectInner;var i;if(e[g]){i=Ta(a,b,g,h)}else if(f[g]){i=Ua(a,b,g,h)}else if(g==="W"){i=Ga(a,h,true,true)}else if(g==="w"){i=Ga(a,h,true,false)}else if(g==="p"){i=Sa(a,b,c.repeat,0,h);c.linewise=true;if(d.visualMode){if(!d.visualLine){d.visualLine=true}}else{var j=d.inputState.operatorArgs;if(j){j.linewise=true}i.end.line--}}else{return null}if(!a.state.vim.visualMode){return[i.start,i.end]}else{return ya(a,i.start,i.end)}},repeatLastCharacterSearch:function(a,b,c){var d=L.lastChararacterSearch;var e=c.repeat;var f=c.forward===d.forward;var g=(d.increment?1:0)*(f?-1:1);a.moveH(-g,"char");c.inclusive=f?true:false;var h=Oa(a,e,f,d.selectedCharacter);if(!h){a.moveH(g,"char");return b}h.ch+=g;return h}};function X(a,b){W[a]=b}function Y(a,b){var c=[];for(var d=0;d<b;d++){c.push(a)}return c}var Z={change:function(b,c,d){var e,f;var g=b.state.vim;L.macroModeState.lastInsertModeChanges.inVisualBlock=g.visualBlock;if(!g.visualMode){var h=d[0].anchor,i=d[0].head;f=b.getRange(h,i);var j=g.lastEditInputState||{};if(j.motion=="moveByWords"&&!B(f)){var k=/\s+$/.exec(f);if(k&&j.motionArgs&&j.motionArgs.forward){i=da(i,0,-k[0].length);f=f.slice(0,-k[0].length)}}var l=i.line-1==b.lastLine();b.replaceRange("",h,i);if(c.linewise&&!l){a.commands.newlineAndIndent(b);h.ch=null}e=h}else{f=b.getSelection();var m=Y("",d.length);b.replaceSelections(m);e=ma(d[0].head,d[0].anchor)}L.registerController.pushText(c.registerName,"change",f,c.linewise,d.length>1);_.enterInsertMode(b,{head:e},b.state.vim)},"delete":function(a,b,c){var e,f;var g=a.state.vim;if(!g.visualBlock){var h=c[0].anchor,i=c[0].head;if(b.linewise&&i.line!=a.firstLine()&&h.line==a.lastLine()&&h.line==i.line-1){if(h.line==a.firstLine()){h.ch=0}else{h=d(h.line-1,pa(a,h.line-1))}}f=a.getRange(h,i);a.replaceRange("",h,i);e=h;if(b.linewise){e=W.moveToFirstNonWhiteSpaceCharacter(a,h)}}else{f=a.getSelection();var j=Y("",c.length);a.replaceSelections(j);e=c[0].anchor}L.registerController.pushText(b.registerName,"delete",f,b.linewise,g.visualBlock);return ba(a,e)},indent:function(a,b,c){var d=a.state.vim;var e=c[0].anchor.line;var f=d.visualBlock?c[c.length-1].anchor.line:c[0].head.line;var g=d.visualMode?b.repeat:1;if(b.linewise){f--}for(var h=e;h<=f;h++){for(var i=0;i<g;i++){a.indentLine(h,b.indentRight)}}return W.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},changeCase:function(a,b,c,d,e){var f=a.getSelections();var g=[];var h=b.toLower;for(var i=0;i<f.length;i++){var j=f[i];var k="";if(h===true){k=j.toLowerCase()}else if(h===false){k=j.toUpperCase()}else{for(var l=0;l<j.length;l++){var m=j.charAt(l);k+=A(m)?m.toLowerCase():m.toUpperCase()}}g.push(k)}a.replaceSelections(g);if(b.shouldMoveCursor){return e}else if(!a.state.vim.visualMode&&b.linewise&&c[0].anchor.line+1==c[0].head.line){return W.moveToFirstNonWhiteSpaceCharacter(a,d)}else if(b.linewise){return d}else{return ma(c[0].anchor,c[0].head)}},yank:function(a,b,c,d){var e=a.state.vim;var f=a.getSelection();var g=e.visualMode?ma(e.sel.anchor,e.sel.head,c[0].head,c[0].anchor):d;L.registerController.pushText(b.registerName,"yank",f,b.linewise,e.visualBlock);return g}};function $(a,b){Z[a]=b}var _={jumpListWalk:function(a,b,c){if(c.visualMode){return}var d=b.repeat;var e=b.forward;var f=L.jumpList;var g=f.move(a,e?d:-d);var h=g?g.find():undefined;h=h?h:a.getCursor();a.setCursor(h)},scroll:function(a,b,c){if(c.visualMode){return}var d=b.repeat||1;var e=a.defaultTextHeight();var f=a.getScrollInfo().top;var g=e*d;var h=b.forward?f+g:f-g;var i=ja(a.getCursor());var j=a.charCoords(i,"local");if(b.forward){if(h>j.top){i.line+=(h-j.top)/e;i.line=Math.ceil(i.line);a.setCursor(i);j=a.charCoords(i,"local");a.scrollTo(null,j.top)}else{a.scrollTo(null,h)}}else{var k=h+a.getScrollInfo().clientHeight;if(k<j.bottom){i.line-=(j.bottom-k)/e;i.line=Math.floor(i.line);a.setCursor(i);j=a.charCoords(i,"local");a.scrollTo(null,j.bottom-a.getScrollInfo().clientHeight)}else{a.scrollTo(null,h)}}},scrollToCursor:function(a,b){var c=a.getCursor().line;var e=a.charCoords(d(c,0),"local");var f=a.getScrollInfo().clientHeight;var g=e.top;var h=e.bottom-g;switch(b.position){case"center":g=g-f/2+h;break;case"bottom":g=g-f+h*1.4;break;case"top":g=g+h*.4;break}a.scrollTo(null,g)},replayMacro:function(a,b,c){var d=b.selectedCharacter;var e=b.repeat;var f=L.macroModeState;if(d=="@"){d=f.latestRegister}while(e--){xb(a,c,f,d)}},enterMacroRecordMode:function(a,b){var c=L.macroModeState;var d=b.selectedCharacter;c.enterMacroRecordMode(a,d)},enterInsertMode:function(b,c,e){if(b.getOption("readOnly")){return}e.insertMode=true;e.insertModeRepeat=c&&c.repeat||1;var f=c?c.insertAt:null;var g=e.sel;var h=c.head||b.getCursor("head");var i=b.listSelections().length;if(f=="eol"){h=d(h.line,pa(b,h.line))}else if(f=="charAfter"){h=da(h,0,1)}else if(f=="firstNonBlank"){h=W.moveToFirstNonWhiteSpaceCharacter(b,h)}else if(f=="startOfSelectedArea"){if(!e.visualBlock){if(g.head.line<g.anchor.line){h=g.head}else{h=d(g.anchor.line,0)}}else{h=d(Math.min(g.head.line,g.anchor.line),Math.min(g.head.ch,g.anchor.ch));i=Math.abs(g.head.line-g.anchor.line)+1}}else if(f=="endOfSelectedArea"){if(!e.visualBlock){if(g.head.line>=g.anchor.line){h=da(g.head,0,1)}else{h=d(g.anchor.line,0)}}else{h=d(Math.min(g.head.line,g.anchor.line),Math.max(g.head.ch+1,g.anchor.ch));i=Math.abs(g.head.line-g.anchor.line)+1}}else if(f=="inplace"){if(e.visualMode){return}}b.setOption("keyMap","vim-insert");b.setOption("disableInput",false);if(c&&c.replace){b.toggleOverwrite(true);b.setOption("keyMap","vim-replace");a.signal(b,"vim-mode-change",{mode:"replace"})}else{b.setOption("keyMap","vim-insert");a.signal(b,"vim-mode-change",{mode:"insert"})}if(!L.macroModeState.isPlaying){b.on("change",Bb);a.on(b.getInputField(),"keydown",Gb)}if(e.visualMode){Ca(b)}ua(b,h,i)},toggleVisualMode:function(b,c,e){var f=c.repeat;var g=b.getCursor();var h;if(!e.visualMode){e.visualMode=true;e.visualLine=!!c.linewise;e.visualBlock=!!c.blockwise;h=ba(b,d(g.line,g.ch+f-1),true);e.sel={anchor:g,head:h};a.signal(b,"vim-mode-change",{mode:"visual",subMode:e.visualLine?"linewise":e.visualBlock?"blockwise":""});za(b);Qa(b,e,"<",ma(g,h));Qa(b,e,">",na(g,h))}else if(e.visualLine^c.linewise||e.visualBlock^c.blockwise){e.visualLine=!!c.linewise;e.visualBlock=!!c.blockwise;a.signal(b,"vim-mode-change",{mode:"visual",subMode:e.visualLine?"linewise":e.visualBlock?"blockwise":""});za(b)}else{Ca(b)}},reselectLastSelection:function(b,c,d){var e=d.lastSelection;if(d.visualMode){xa(b,d)}if(e){var f=e.anchorMark.find();var g=e.headMark.find();if(!f||!g){return}d.sel={anchor:f,head:g};d.visualMode=true;d.visualLine=e.visualLine;d.visualBlock=e.visualBlock;za(b);Qa(b,d,"<",ma(f,g));Qa(b,d,">",na(f,g));a.signal(b,"vim-mode-change",{mode:"visual",subMode:d.visualLine?"linewise":d.visualBlock?"blockwise":""})}},joinLines:function(a,b,c){var e,f;if(c.visualMode){e=a.getCursor("anchor");f=a.getCursor("head");if(la(f,e)){var g=f;f=e;e=g}f.ch=pa(a,f.line)-1}else{var h=Math.max(b.repeat,2);e=a.getCursor();f=ba(a,d(e.line+h-1,Infinity))}var i=0;for(var j=e.line;j<f.line;j++){i=pa(a,e.line);var g=d(e.line+1,pa(a,e.line+1));var k=a.getRange(e,g);k=k.replace(/\n\s*/g," ");a.replaceRange(k,e,g)}var l=d(e.line,i);if(c.visualMode){Ca(a,false)}a.setCursor(l)},newLineAndEnterInsertMode:function(b,c,e){e.insertMode=true;var f=ja(b.getCursor());if(f.line===b.firstLine()&&!c.after){b.replaceRange("\n",d(b.firstLine(),0));b.setCursor(b.firstLine(),0)}else{f.line=c.after?f.line:f.line-1;f.ch=pa(b,f.line);b.setCursor(f);var g=a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent;g(b)}this.enterInsertMode(b,{repeat:c.repeat},e)},paste:function(a,b,c){var e=ja(a.getCursor());var f=L.registerController.getRegister(b.registerName);var g=f.toString();if(!g){return}if(b.matchIndent){var h=a.getOption("tabSize");var i=function(a){var b=a.split("	").length-1;var c=a.split(" ").length-1;return b*h+c*1};var j=a.getLine(a.getCursor().line);var k=i(j.match(/^\s*/)[0]);var l=g.replace(/\n$/,"");var m=g!==l;var n=i(g.match(/^\s*/)[0]);var g=l.replace(/^\s*/gm,function(b){var c=k+(i(b)-n);if(c<0){return""}else if(a.getOption("indentWithTabs")){var d=Math.floor(c/h);return Array(d+1).join("	")}else{return Array(c+1).join(" ")}});g+=m?"\n":""}if(b.repeat>1){var g=Array(b.repeat+1).join(g)}var o=f.linewise;var p=f.blockwise;if(o){if(c.visualMode){g=c.visualLine?g.slice(0,-1):"\n"+g.slice(0,g.length-1)+"\n"}else if(b.after){g="\n"+g.slice(0,g.length-1);e.ch=pa(a,e.line)}else{e.ch=0}}else{if(p){g=g.split("\n");for(var q=0;q<g.length;q++){g[q]=g[q]==""?" ":g[q]}}e.ch+=b.after?1:0}var r;var s;if(c.visualMode){c.lastPastedText=g;var t;var u=wa(a,c);var v=u[0];var w=u[1];var x=a.getSelection();var y=a.listSelections();var z=new Array(y.length).join("1").split("1");if(c.lastSelection){t=c.lastSelection.headMark.find()}L.registerController.unnamedRegister.setText(x);if(p){a.replaceSelections(z);w=d(v.line+g.length-1,v.ch);a.setCursor(v);ta(a,w);a.replaceSelections(g);r=v}else if(c.visualBlock){a.replaceSelections(z);a.setCursor(v);a.replaceRange(g,v,v);r=v}else{a.replaceRange(g,v,w);r=a.posFromIndex(a.indexFromPos(v)+g.length-1)}if(t){c.lastSelection.headMark=a.setBookmark(t)}if(o){r.ch=0}}else{if(p){a.setCursor(e);for(var q=0;q<g.length;q++){var A=e.line+q;if(A>a.lastLine()){a.replaceRange("\n",d(A,0))}var B=pa(a,A);if(B<e.ch){sa(a,A,e.ch)}}a.setCursor(e);ta(a,d(e.line+g.length-1,e.ch));a.replaceSelections(g);r=e}else{a.replaceRange(g,e);if(o&&b.after){r=d(e.line+1,Fa(a.getLine(e.line+1)))}else if(o&&!b.after){r=d(e.line,Fa(a.getLine(e.line)))}else if(!o&&b.after){s=a.indexFromPos(e);r=a.posFromIndex(s+g.length-1)}else{s=a.indexFromPos(e);r=a.posFromIndex(s+g.length)}}}if(c.visualMode){Ca(a,false)}a.setCursor(r)},undo:function(b,c){b.operation(function(){ia(b,a.commands.undo,c.repeat)();b.setCursor(b.getCursor("anchor"))})},redo:function(b,c){ia(b,a.commands.redo,c.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){var d=b.selectedCharacter;Qa(a,c,d,a.getCursor())},replace:function(b,c,e){var f=c.selectedCharacter;var g=b.getCursor();var h;var i;var j=b.listSelections();if(e.visualMode){g=b.getCursor("start");i=b.getCursor("end")}else{var k=b.getLine(g.line);h=g.ch+c.repeat;if(h>k.length){h=k.length}i=d(g.line,h)}if(f=="\n"){if(!e.visualMode)b.replaceRange("",g,i);(a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent)(b)}else{var l=b.getRange(g,i);l=l.replace(/[^\n]/g,f);if(e.visualBlock){var m=new Array(b.getOption("tabSize")+1).join(" ");l=b.getSelection();l=l.replace(/\t/g,m).replace(/[^\n]/g,f).split("\n");b.replaceSelections(l)}else{b.replaceRange(l,g,i)}if(e.visualMode){g=la(j[0].anchor,j[0].head)?j[0].anchor:j[0].head;b.setCursor(g);Ca(b,false)}else{b.setCursor(da(i,0,-1))}}},incrementNumberToken:function(a,b){var c=a.getCursor();var e=a.getLine(c.line);var f=/-?\d+/g;var g;var h;var i;var j;var k;while((g=f.exec(e))!==null){k=g[0];h=g.index;i=h+k.length;if(c.ch<i)break}if(!b.backtrack&&i<=c.ch)return;if(k){var l=b.increase?1:-1;var m=parseInt(k)+l*b.repeat;var n=d(c.line,h);var o=d(c.line,i);j=m.toString();a.replaceRange(j,n,o)}else{return}a.setCursor(d(c.line,h+j.length-1))},repeatLastEdit:function(a,b,c){var d=c.lastEditInputState;if(!d){return}var e=b.repeat;if(e&&b.repeatIsExplicit){c.lastEditInputState.repeatOverride=e}else{e=c.lastEditInputState.repeatOverride||e}Hb(a,c,e,false)},exitInsertMode:ub};function aa(a,b){_[a]=b}function ba(a,b,c){var e=Math.min(Math.max(a.firstLine(),b.line),a.lastLine());var f=pa(a,e)-1;f=c?f+1:f;var g=Math.min(Math.max(0,b.ch),f);return d(e,g)}function ca(a){var b={};for(var c in a){if(a.hasOwnProperty(c)){b[c]=a[c]}}return b}function da(a,b,c){if(typeof b==="object"){c=b.ch;b=b.line}return d(a.line+b,a.ch+c)}function ea(a,b){return{line:b.line-a.line,ch:b.line-a.line}}function fa(a,b,c,d){var e,f=[],g=[];for(var h=0;h<b.length;h++){var i=b[h];if(c=="insert"&&i.context!="insert"||i.context&&i.context!=c||d.operator&&i.type=="action"||!(e=ga(a,i.keys))){continue}if(e=="partial"){f.push(i)}if(e=="full"){g.push(i)}}return{partial:f.length&&f,full:g.length&&g}}function ga(a,b){if(b.slice(-11)=="<character>"){var c=b.length-11;var d=a.slice(0,c);var e=b.slice(0,c);return d==e&&a.length>c?"full":e.indexOf(d)==0?"partial":false}else{return a==b?"full":b.indexOf(a)==0?"partial":false}}function ha(a){var b=/^.*(<[\w\-]+>)$/.exec(a);var c=b?b[1]:a.slice(-1);if(c.length>1){switch(c){case"<CR>":c="\n";break;case"<Space>":c=" ";break;default:break}}return c}function ia(a,b,c){return function(){for(var d=0;d<c;d++){b(a)}}}function ja(a){return d(a.line,a.ch)}function ka(a,b){return a.ch==b.ch&&a.line==b.line}function la(a,b){if(a.line<b.line){return true}if(a.line==b.line&&a.ch<b.ch){return true}return false}function ma(a,b){if(arguments.length>2){b=ma.apply(undefined,Array.prototype.slice.call(arguments,1))}return la(a,b)?a:b}function na(a,b){if(arguments.length>2){b=na.apply(undefined,Array.prototype.slice.call(arguments,1))}return la(a,b)?b:a}function oa(a,b,c){var d=la(a,b);var e=la(b,c);return d&&e}function pa(a,b){return a.getLine(b).length}function qa(a){if(a.trim){return a.trim()}return a.replace(/^\s+|\s+$/g,"")}function ra(a){return a.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function sa(a,b,c){var e=pa(a,b);var f=new Array(c-e+1).join(" ");a.setCursor(d(b,e));a.replaceRange(f,a.getCursor())}function ta(a,b){var c=[],e=a.listSelections();var f=ja(a.clipPos(b));var g=!ka(b,f);var h=a.getCursor("head");var i=va(e,h);var j=ka(e[i].head,e[i].anchor);var k=e.length-1;var l=k-i>i?k:0;var m=e[l].anchor;var n=Math.min(m.line,f.line);var o=Math.max(m.line,f.line);var p=m.ch,q=f.ch;var r=e[l].head.ch-p;var s=q-p;if(r>0&&s<=0){p++;if(!g){q--}}else if(r<0&&s>=0){p--;if(!j){q++}}else if(r<0&&s==-1){p--;q++}for(var t=n;t<=o;t++){var u={anchor:new d(t,p),head:new d(t,q)};c.push(u)}i=f.line==o?c.length-1:0;a.setSelections(c);b.ch=q;m.ch=p;return m}function ua(a,b,c){var d=[];for(var e=0;e<c;e++){var f=da(b,e,0);d.push({anchor:f,head:f})}a.setSelections(d,0)}function va(a,b,c){for(var d=0;d<a.length;d++){var e=c!="head"&&ka(a[d].anchor,b);var f=c!="anchor"&&ka(a[d].head,b);if(e||f){return d}}return-1}function wa(a,b){var c=b.lastSelection;var e=function(){var b=a.listSelections();var c=b[0];var d=b[b.length-1];var e=la(c.anchor,c.head)?c.anchor:c.head;var f=la(d.anchor,d.head)?d.head:d.anchor;return[e,f]};var f=function(){var b=a.getCursor();var e=a.getCursor();var f=c.visualBlock;if(f){var g=f.width;var h=f.height;e=d(b.line+h,b.ch+g);var i=[];for(var j=b.line;j<e.line;j++){var k=d(j,b.ch);var l=d(j,e.ch);var m={anchor:k,head:l};i.push(m)}a.setSelections(i)}else{var n=c.anchorMark.find();var o=c.headMark.find();var p=o.line-n.line;var q=o.ch-n.ch;e={line:e.line+p,ch:p?e.ch:q+e.ch};if(c.visualLine){b=d(b.line,0);e=d(e.line,pa(a,e.line))}a.setSelection(b,e)}return[b,e]};if(!b.visualMode){return f()}else{return e()}}function xa(a,b){var c=b.sel.anchor;var d=b.sel.head;if(b.lastPastedText){d=a.posFromIndex(a.indexFromPos(c)+b.lastPastedText.length);b.lastPastedText=null}b.lastSelection={anchorMark:a.setBookmark(c),headMark:a.setBookmark(d),anchor:ja(c),head:ja(d),visualMode:b.visualMode,visualLine:b.visualLine,visualBlock:b.visualBlock}}function ya(a,b,c){var e=a.state.vim.sel;var f=e.head;var g=e.anchor;var h;if(la(c,b)){h=c;c=b;b=h}if(la(f,g)){f=ma(b,f);g=na(g,c)}else{g=ma(b,g);f=na(f,c);f=da(f,0,-1);if(f.ch==-1&&f.line!=a.firstLine()){f=d(f.line-1,pa(a,f.line-1))}}return[g,f]}function za(a,b,c){var d=a.state.vim;b=b||d.sel;var c=c||d.visualLine?"line":d.visualBlock?"block":"char";var e=Aa(a,b,c);a.setSelections(e.ranges,e.primary);Db(a)}function Aa(a,b,c,e){var f=ja(b.head);var g=ja(b.anchor);if(c=="char"){var h=!e&&!la(b.head,b.anchor)?1:0;var i=la(b.head,b.anchor)?1:0;f=da(b.head,0,h);g=da(b.anchor,0,i);return{ranges:[{anchor:g,head:f}],primary:0}}else if(c=="line"){if(!la(b.head,b.anchor)){g.ch=0;var j=a.lastLine();if(f.line>j){f.line=j}f.ch=pa(a,f.line)}else{f.ch=0;g.ch=pa(a,g.line)}return{ranges:[{anchor:g,head:f}],primary:0}}else if(c=="block"){var k=Math.min(g.line,f.line),l=Math.min(g.ch,f.ch),m=Math.max(g.line,f.line),n=Math.max(g.ch,f.ch)+1;var o=m-k+1;var p=f.line==k?0:o-1;var q=[];for(var r=0;r<o;r++){q.push({anchor:d(k+r,l),head:d(k+r,n)})}return{ranges:q,primary:p}}}function Ba(a){var b=a.getCursor("head");if(a.getSelection().length==1){b=ma(b,a.getCursor("anchor"))}return b}function Ca(b,c){var d=b.state.vim;if(c!==false){b.setCursor(ba(b,d.sel.head))}xa(b,d);d.visualMode=false;d.visualLine=false;d.visualBlock=false;a.signal(b,"vim-mode-change",{mode:"normal"});if(d.fakeCursor){d.fakeCursor.clear()}}function Da(a,b,c){var d=a.getRange(b,c);if(/\n\s*$/.test(d)){var e=d.split("\n");e.pop();var f;for(var f=e.pop();e.length>0&&f&&B(f);f=e.pop()){c.line--;c.ch=0}if(f){c.line--;c.ch=pa(a,c.line)}else{c.ch=0}}}function Ea(a,b,c){b.ch=0;c.ch=0;c.line++}function Fa(a){if(!a){return 0}var b=a.search(/\S/);return b==-1?a.length:b}function Ga(a,b,c,e,f){var g=Ba(a);var h=a.getLine(g.line);var i=g.ch;var j=f?o[0]:p[0];while(!j(h.charAt(i))){i++;if(i>=h.length){return null}}if(e){j=p[0]}else{j=o[0];if(!j(h.charAt(i))){j=o[1]}}var k=i,l=i;while(j(h.charAt(k))&&k<h.length){k++}while(j(h.charAt(l))&&l>=0){l--}l++;if(b){var m=k;while(/\s/.test(h.charAt(k))&&k<h.length){k++}if(m==k){var n=l;while(/\s/.test(h.charAt(l-1))&&l>0){l--}if(!l){l=n}}}return{start:d(g.line,l),end:d(g.line,k)}}function Ha(a,b,c){if(!ka(b,c)){L.jumpList.add(a,b,c)}}function Ia(a,b){L.lastChararacterSearch.increment=a;L.lastChararacterSearch.forward=b.forward;L.lastChararacterSearch.selectedCharacter=b.selectedCharacter}var Ja={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var Ka={bracket:{isComplete:function(a){if(a.nextCh===a.symb){a.depth++;if(a.depth>=1)return true}else if(a.nextCh===a.reverseSymb){a.depth--}return false}},section:{init:function(a){a.curMoveThrough=true;a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return a.index===0&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b=a.lastCh==="*"&&a.nextCh==="/";a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb=a.symb==="m"?"{":"}";a.reverseSymb=a.symb==="{"?"}":"{"},isComplete:function(a){if(a.nextCh===a.symb)return true;return false}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if(a.nextCh==="#"){var b=a.lineText.match(/#(\w+)/)[1];if(b==="endif"){if(a.forward&&a.depth===0){return true}a.depth++}else if(b==="if"){if(!a.forward&&a.depth===0){return true}a.depth--}if(b==="else"&&a.depth===0)return true}return false}}};function La(a,b,c,e){var f=ja(a.getCursor());var g=c?1:-1;var h=c?a.lineCount():-1;var i=f.ch;var j=f.line;var k=a.getLine(j);var l={lineText:k,nextCh:k.charAt(i),lastCh:null,index:i,symb:e,reverseSymb:(c?{")":"(","}":"{"}:{"(":")","{":"}"})[e],forward:c,depth:0,curMoveThrough:false};var m=Ja[e];if(!m)return f;var n=Ka[m].init;var o=Ka[m].isComplete;if(n){n(l)}while(j!==h&&b){l.index+=g;l.nextCh=l.lineText.charAt(l.index);if(!l.nextCh){j+=g;l.lineText=a.getLine(j)||"";if(g>0){l.index=0}else{var p=l.lineText.length;l.index=p>0?p-1:0}l.nextCh=l.lineText.charAt(l.index)}if(o(l)){f.line=j;f.ch=l.index;b--}}if(l.nextCh||l.curMoveThrough){return d(j,l.index)}return f}function Ma(a,b,c,d,e){var f=b.line;var g=b.ch;var h=a.getLine(f);var i=c?1:-1;var j=d?p:o;if(e&&h==""){f+=i;h=a.getLine(f);if(!w(a,f)){return null}g=c?0:h.length}while(true){if(e&&h==""){return{from:0,to:0,line:f}}var k=i>0?h.length:-1;var l=k,m=k;while(g!=k){var n=false;for(var q=0;q<j.length&&!n;++q){if(j[q](h.charAt(g))){l=g;while(g!=k&&j[q](h.charAt(g))){g+=i}m=g;n=l!=m;if(l==b.ch&&f==b.line&&m==l+i){continue}else{return{from:Math.min(l,m+1),to:Math.max(l,m),line:f}}}}if(!n){g+=i}}f+=i;if(!w(a,f)){return null}h=a.getLine(f);g=i>0?0:h.length}throw new Error("The impossible happened.")}function Na(a,b,c,e,f,g){var h=ja(b);var i=[];if(e&&!f||!e&&f){c++}var j=!(e&&f);for(var k=0;k<c;k++){var l=Ma(a,b,e,g,j);if(!l){var m=pa(a,a.lastLine());i.push(e?{line:a.lastLine(),from:m,to:m}:{line:0,from:0,to:0});break}i.push(l);b=d(l.line,e?l.to-1:l.from)}var n=i.length!=c;var o=i[0];var p=i.pop();if(e&&!f){if(!n&&(o.from!=h.ch||o.line!=h.line)){p=i.pop()}return d(p.line,p.from)}else if(e&&f){return d(p.line,p.to-1)}else if(!e&&f){if(!n&&(o.to!=h.ch||o.line!=h.line)){p=i.pop()}return d(p.line,p.to)}else{return d(p.line,p.from)}}function Oa(a,b,c,e){var f=a.getCursor();var g=f.ch;var h;for(var i=0;i<b;i++){var j=a.getLine(f.line);h=Ra(g,j,e,c,true);if(h==-1){return null}g=h}return d(a.getCursor().line,h)}function Pa(a,b){var c=a.getCursor().line;return ba(a,d(c,b-1))}function Qa(a,b,c,d){if(!C(c,u)){return}if(b.marks[c]){b.marks[c].clear()}b.marks[c]=a.setBookmark(d)}function Ra(a,b,c,d,e){var f;if(d){f=b.indexOf(c,a+1);if(f!=-1&&!e){f-=1}}else{f=b.lastIndexOf(c,a-1);if(f!=-1&&!e){f+=1}}return f}function Sa(a,b,c,e,f){var g=b.line;var h=a.firstLine();var i=a.lastLine();var j,k,l=g;function m(b){return!a.getLine(b)}function n(a,b,c){if(c){return m(a)!=m(a+b)}return!m(a)&&m(a+b)}if(e){while(h<=l&&l<=i&&c>0){if(n(l,e)){c--}l+=e}return new d(l,0)}var o=a.state.vim;if(o.visualLine&&n(g,1,true)){var p=o.sel.anchor;if(n(p.line,-1,true)){if(!f||p.line!=g){g+=1}}}var q=m(g);for(l=g;l<=i&&c;l++){if(n(l,1,true)){if(!f||m(l)!=q){c--}}}k=new d(l,0);if(l>i&&!q){q=true}else{f=false}for(l=g;l>h;l--){if(!f||m(l)==q||l==g){if(n(l,-1,true)){break}}}j=new d(l,0);return{start:j,end:k}}function Ta(a,b,c,e){var f=b,g,h;var i={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[c];var j={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[c];var k=a.getLine(f.line).charAt(f.ch);var l=k===j?1:0;g=a.scanForBracket(d(f.line,f.ch+l),-1,null,{bracketRegex:i});h=a.scanForBracket(d(f.line,f.ch+l),1,null,{bracketRegex:i});if(!g||!h){return{start:f,end:f}}g=g.pos;h=h.pos;if(g.line==h.line&&g.ch>h.ch||g.line>h.line){var m=g;g=h;h=m}if(e){h.ch+=1}else{g.ch+=1}return{start:g,end:h}}function Ua(a,b,c,e){var f=ja(b);var g=a.getLine(f.line);var h=g.split("");var i,j,k,l;var m=h.indexOf(c);if(f.ch<m){f.ch=m}else if(m<f.ch&&h[f.ch]==c){j=f.ch;--f.ch}if(h[f.ch]==c&&!j){i=f.ch+1}else{for(k=f.ch;k>-1&&!i;k--){if(h[k]==c){i=k+1}}}if(i&&!j){for(k=i,l=h.length;k<l&&!j;k++){if(h[k]==c){j=k}}}if(!i||!j){return{start:f,end:f}}if(e){--i;++j}return{start:d(f.line,i),end:d(f.line,j)}}E("pcre",true,"boolean");function Va(){}Va.prototype={getQuery:function(){return L.query},setQuery:function(a){L.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return L.isReversed},setReversed:function(a){L.isReversed=a},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(a){this.annotate=a}};function Wa(a){var b=a.state.vim;return b.searchState_||(b.searchState_=new Va)}function Xa(a,b,c,d,e){if(a.openDialog){a.openDialog(b,d,{bottom:true,value:e.value,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,selectValueOnOpen:false})}else{d(prompt(c,""))}}function Ya(a){var b=Za(a)||[];if(!b.length)return[];var c=[];if(b[0]!==0)return;for(var d=0;d<b.length;d++){if(typeof b[d]=="number")c.push(a.substring(b[d]+1,b[d+1]))}return c}function Za(a){var b=false;var c=[];for(var d=0;d<a.length;d++){var e=a.charAt(d);if(!b&&e=="/"){c.push(d)}b=!b&&e=="\\"}return c}function $a(a){var b="|(){";var c="}";var d=false;var e=[];for(var f=-1;f<a.length;f++){var g=a.charAt(f)||"";var h=a.charAt(f+1)||"";var i=h&&b.indexOf(h)!=-1;if(d){if(g!=="\\"||!i){e.push(g)}d=false}else{if(g==="\\"){d=true;if(h&&c.indexOf(h)!=-1){i=true}if(!i||h==="\\"){e.push(g)}}else{e.push(g);if(i&&h!=="\\"){e.push("\\")}}}}return e.join("")}var _a={"\\n":"\n","\\r":"\r","\\t":"	"};function ab(a){var b=false;var c=[];for(var d=-1;d<a.length;d++){var e=a.charAt(d)||"";var f=a.charAt(d+1)||"";if(_a[e+f]){c.push(_a[e+f]);d++}else if(b){c.push(e);b=false}else{if(e==="\\"){b=true;if(z(f)||f==="$"){c.push("$")}else if(f!=="/"&&f!=="\\"){c.push("\\")}}else{if(e==="$"){c.push("$")}c.push(e);if(f==="/"){c.push("\\")}}}}return c.join("")}var bb={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	"};function cb(b){var c=new a.StringStream(b);var d=[];while(!c.eol()){while(c.peek()&&c.peek()!="\\"){d.push(c.next())}var e=false;for(var f in bb){if(c.match(f,true)){e=true;d.push(bb[f]);break}}if(!e){d.push(c.next())}}return d.join("")}function db(a,b,c){var d=L.registerController.getRegister("/");d.setText(a);if(a instanceof RegExp){return a}var e=Za(a);var f;var g;if(!e.length){f=a}else{f=a.substring(0,e[0]);var h=a.substring(e[0]);g=h.indexOf("i")!=-1}if(!f){return null}if(!G("pcre")){f=$a(f)}if(c){b=/^[^A-Z]*$/.test(f)}var i=new RegExp(f,b||g?"i":undefined);return i}function eb(a,b){if(a.openNotification){a.openNotification('<span style="color: red">'+b+"</span>",{bottom:true,duration:5e3})}else{alert(b)}}function fb(a,b){var c="";if(a){c+='<span style="font-family: monospace">'+a+"</span>"}c+='<input type="text"/> '+'<span style="color: #888">';if(b){c+='<span style="color: #888">';c+=b;c+="</span>"}return c}var gb="(Javascript regexp)";function hb(a,b){var c=(b.prefix||"")+" "+(b.desc||"");var d=fb(b.prefix,b.desc);Xa(a,d,c,b.onClose,b)}function ib(a,b){if(a instanceof RegExp&&b instanceof RegExp){var c=["global","multiline","ignoreCase","source"];for(var d=0;d<c.length;d++){var e=c[d];if(a[e]!==b[e]){return false}}return true}return false}function jb(a,b,c,d){if(!b){return}var e=Wa(a);var f=db(b,!!c,!!d);if(!f){return}lb(a,f);if(ib(f,e.getQuery())){return f}e.setQuery(f);return f}function kb(a){if(a.source.charAt(0)=="^"){var b=true}return{token:function(c){if(b&&!c.sol()){c.skipToEnd();return}var d=c.match(a,false);if(d){if(d[0].length==0){c.next();return"searching"}if(!c.sol()){c.backUp(1);if(!a.exec(c.next()+d[0])){c.next();return null}}c.match(a);return"searching"}while(!c.eol()){c.next();if(c.match(a,false))break}},query:a}}function lb(a,b){var c=Wa(a);var d=c.getOverlay();if(!d||b!=d.query){if(d){a.removeOverlay(d)}d=kb(b);a.addOverlay(d);if(a.showMatchesOnScrollbar){if(c.getScrollbarAnnotate()){c.getScrollbarAnnotate().clear()}c.setScrollbarAnnotate(a.showMatchesOnScrollbar(b))}c.setOverlay(d)}}function mb(a,b,c,e){if(e===undefined){e=1}return a.operation(function(){var f=a.getCursor();var g=a.getSearchCursor(c,f);for(var h=0;h<e;h++){var i=g.find(b);if(h==0&&i&&ka(g.from(),f)){i=g.find(b)}if(!i){g=a.getSearchCursor(c,b?d(a.lastLine()):d(a.firstLine(),0));if(!g.find(b)){return}}}return g.from()})}function nb(a){var b=Wa(a);a.removeOverlay(Wa(a).getOverlay());b.setOverlay(null);if(b.getScrollbarAnnotate()){b.getScrollbarAnnotate().clear();b.setScrollbarAnnotate(null)}}function ob(a,b,c){if(typeof a!="number"){a=a.line}if(b instanceof Array){return C(a,b)}else{if(c){return a>=b&&a<=c}else{return a==b}}}function pb(a){var b=a.getScrollInfo();var c=6;var d=10;var e=a.coordsChar({left:0,top:c+b.top},"local");var f=b.clientHeight-d+b.top;var g=a.coordsChar({left:0,top:f},"local");return{top:e.line,bottom:g.line}}var qb=function(){this.buildCommandMap_()};qb.prototype={processCommand:function(a,b,c){var d=this;a.operation(function(){a.curOp.isVimOp=true;d._processCommand(a,b,c)})},_processCommand:function(b,c,d){var e=b.state.vim;var f=L.registerController.getRegister(":");var g=f.toString();if(e.visualMode){Ca(b)}var h=new a.StringStream(c);f.setText(c);var i=d||{};i.input=c;try{this.parseInput_(b,h,i)}catch(j){eb(b,j);throw j}var k;var l;if(!i.commandName){if(i.line!==undefined){l="move"}}else{k=this.matchCommand_(i.commandName);if(k){l=k.name;if(k.excludeFromCommandHistory){f.setText(g)}this.parseCommandArgs_(h,i,k);if(k.type=="exToKey"){for(var m=0;m<k.toKeys.length;m++){a.Vim.handleKey(b,k.toKeys[m],"mapping")}return}else if(k.type=="exToEx"){this.processCommand(b,k.toInput);return}}}if(!l){eb(b,'Not an editor command ":'+c+'"');return}try{rb[l](b,i);if((!k||!k.possiblyAsync)&&i.callback){i.callback()}}catch(j){eb(b,j);throw j}},parseInput_:function(a,b,c){b.eatWhile(":");if(b.eat("%")){c.line=a.firstLine();c.lineEnd=a.lastLine()}else{c.line=this.parseLineSpec_(a,b);if(c.line!==undefined&&b.eat(",")){c.lineEnd=this.parseLineSpec_(a,b)}}var d=b.match(/^(\w+)/);if(d){c.commandName=d[1]}else{c.commandName=b.match(/.*/)[0]}return c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c){return parseInt(c[1],10)-1}switch(b.next()){case".":return a.getCursor().line;case"$":return a.lastLine();case"'":var d=a.state.vim.marks[b.next()];if(d&&d.find()){return d.find().line;
}throw new Error("Mark not set");default:b.backUp(1);return undefined}},parseCommandArgs_:function(a,b,c){if(a.eol()){return}b.argString=a.match(/.*/)[0];var d=c.argDelimiter||/\s+/;var e=qa(b.argString).split(d);if(e.length&&e[0]){b.args=e}},matchCommand_:function(a){for(var b=a.length;b>0;b--){var c=a.substring(0,b);if(this.commandMap_[c]){var d=this.commandMap_[c];if(d.name.indexOf(a)===0){return d}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<c.length;a++){var b=c[a];var d=b.shortName||b.name;this.commandMap_[d]=b}},map:function(a,c,d){if(a!=":"&&a.charAt(0)==":"){if(d){throw Error("Mode not supported for ex mappings")}var e=a.substring(1);if(c!=":"&&c.charAt(0)==":"){this.commandMap_[e]={name:e,type:"exToEx",toInput:c.substring(1),user:true}}else{this.commandMap_[e]={name:e,type:"exToKey",toKeys:c,user:true}}}else{if(c!=":"&&c.charAt(0)==":"){var f={keys:a,type:"keyToEx",exArgs:{input:c.substring(1)},user:true};if(d){f.context=d}b.unshift(f)}else{var f={keys:a,type:"keyToKey",toKeys:c,user:true};if(d){f.context=d}b.unshift(f)}}},unmap:function(a,c){if(a!=":"&&a.charAt(0)==":"){if(c){throw Error("Mode not supported for ex mappings")}var d=a.substring(1);if(this.commandMap_[d]&&this.commandMap_[d].user){delete this.commandMap_[d];return}}else{var e=a;for(var f=0;f<b.length;f++){if(e==b[f].keys&&b[f].context===c&&b[f].user){b.splice(f,1);return}}}throw Error("No such mapping.")}};var rb={colorscheme:function(a,b){if(!b.args||b.args.length<1){eb(a,a.getOption("theme"));return}a.setOption("theme",b.args[0])},map:function(a,b,c){var d=b.args;if(!d||d.length<2){if(a){eb(a,"Invalid mapping: "+b.input)}return}sb.map(d[0],d[1],c)},imap:function(a,b){this.map(a,b,"insert")},nmap:function(a,b){this.map(a,b,"normal")},vmap:function(a,b){this.map(a,b,"visual")},unmap:function(a,b,c){var d=b.args;if(!d||d.length<1){if(a){eb(a,"No such mapping: "+b.input)}return}sb.unmap(d[0],c)},move:function(a,b){V.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:b.line+1})},set:function(a,b){var c=b.args;var d=b.setCfg||{};if(!c||c.length<1){if(a){eb(a,"Invalid mapping: "+b.input)}return}var e=c[0].split("=");var f=e[0];var g=e[1];var h=false;if(f.charAt(f.length-1)=="?"){if(g){throw Error("Trailing characters: "+b.argString)}f=f.substring(0,f.length-1);h=true}if(g===undefined&&f.substring(0,2)=="no"){f=f.substring(2);g=false}var i=D[f]&&D[f].type=="boolean";if(i&&g==undefined){g=true}if(!i&&g===undefined||h){var j=G(f,a,d);if(j===true||j===false){eb(a," "+(j?"":"no")+f)}else{eb(a,"  "+f+"="+j)}}else{F(f,g,a,d)}},setlocal:function(a,b){b.setCfg={scope:"local"};this.set(a,b)},setglobal:function(a,b){b.setCfg={scope:"global"};this.set(a,b)},registers:function(a,b){var c=b.args;var d=L.registerController.registers;var e="----------Registers----------<br><br>";if(!c){for(var f in d){var g=d[f].toString();if(g.length){e+='"'+f+"    "+g+"<br>"}}}else{var f;c=c.join("");for(var h=0;h<c.length;h++){f=c.charAt(h);if(!L.registerController.isValidRegister(f)){continue}var i=d[f]||new R;e+='"'+f+"    "+i.toString()+"<br>"}}eb(a,e)},sort:function(b,c){var e,f,g,h;function i(){if(c.argString){var b=new a.StringStream(c.argString);if(b.eat("!")){e=true}if(b.eol()){return}if(!b.eatSpace()){return"Invalid arguments"}var d=b.match(/[a-z]+/);if(d){d=d[0];f=d.indexOf("i")!=-1;g=d.indexOf("u")!=-1;var i=d.indexOf("d")!=-1&&1;var j=d.indexOf("x")!=-1&&1;var k=d.indexOf("o")!=-1&&1;if(i+j+k>1){return"Invalid arguments"}h=i&&"decimal"||j&&"hex"||k&&"octal"}if(b.match(/\/.*\//)){return"patterns not supported"}}}var j=i();if(j){eb(b,j+": "+c.argString);return}var k=c.line||b.firstLine();var l=c.lineEnd||c.line||b.lastLine();if(k==l){return}var m=d(k,0);var n=d(l,pa(b,l));var o=b.getRange(m,n).split("\n");var p=h=="decimal"?/(-?)([\d]+)/:h=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:h=="octal"?/([0-7]+)/:null;var q=h=="decimal"?10:h=="hex"?16:h=="octal"?8:null;var r=[],s=[];if(h){for(var t=0;t<o.length;t++){if(p.exec(o[t])){r.push(o[t])}else{s.push(o[t])}}}else{s=o}function u(a,b){if(e){var c;c=a;a=b;b=c}if(f){a=a.toLowerCase();b=b.toLowerCase()}var d=h&&p.exec(a);var g=h&&p.exec(b);if(!d){return a<b?-1:1}d=parseInt((d[1]+d[2]).toLowerCase(),q);g=parseInt((g[1]+g[2]).toLowerCase(),q);return d-g}r.sort(u);s.sort(u);o=!e?s.concat(r):r.concat(s);if(g){var v=o;var w;o=[];for(var t=0;t<v.length;t++){if(v[t]!=w){o.push(v[t])}w=v[t]}}b.replaceRange(o.join("\n"),m,n)},global:function(a,b){var c=b.argString;if(!c){eb(a,"Regular Expression missing from global");return}var d=b.line!==undefined?b.line:a.firstLine();var e=b.lineEnd||b.line||a.lastLine();var f=Ya(c);var g=c,h;if(f.length){g=f[0];h=f.slice(1,f.length).join("/")}if(g){try{jb(a,g,true,true)}catch(i){eb(a,"Invalid regex: "+g);return}}var j=Wa(a).getQuery();var k=[],l="";for(var m=d;m<=e;m++){var n=j.test(a.getLine(m));if(n){k.push(m+1);l+=a.getLine(m)+"<br>"}}if(!h){eb(a,l);return}var o=0;var p=function(){if(o<k.length){var b=k[o]+h;sb.processCommand(a,b,{callback:p})}o++};p()},substitute:function(a,b){if(!a.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or "+"any other getSearchCursor implementation.")}var c=b.argString;var e=c?Ya(c):[];var f,g="",h,i,j;var k=false;var l=false;if(e.length){f=e[0];g=e[1];if(g!==undefined){if(G("pcre")){g=cb(g)}else{g=ab(g)}L.lastSubstituteReplacePart=g}h=e[2]?e[2].split(" "):[]}else{if(c&&c.length){eb(a,"Substitutions should be of the form "+":s/pattern/replace/");return}}if(h){i=h[0];j=parseInt(h[1]);if(i){if(i.indexOf("c")!=-1){k=true;i.replace("c","")}if(i.indexOf("g")!=-1){l=true;i.replace("g","")}f=f+"/"+i}}if(f){try{jb(a,f,true,true)}catch(m){eb(a,"Invalid regex: "+f);return}}g=g||L.lastSubstituteReplacePart;if(g===undefined){eb(a,"No previous substitute regular expression");return}var n=Wa(a);var o=n.getQuery();var p=b.line!==undefined?b.line:a.getCursor().line;var q=b.lineEnd||p;if(p==a.firstLine()&&q==a.lastLine()){q=Infinity}if(j){p=q;q=p+j-1}var r=ba(a,d(p,0));var s=a.getSearchCursor(o,r);tb(a,k,l,p,q,s,o,g,b.callback)},redo:a.commands.redo,undo:a.commands.undo,write:function(b){if(a.commands.save){a.commands.save(b)}else{b.save()}},nohlsearch:function(a){nb(a)},delmarks:function(b,c){if(!c.argString||!qa(c.argString)){eb(b,"Argument required");return}var d=b.state.vim;var e=new a.StringStream(qa(c.argString));while(!e.eol()){e.eatSpace();var f=e.pos;if(!e.match(/[a-zA-Z]/,false)){eb(b,"Invalid argument: "+c.argString.substring(f));return}var g=e.next();if(e.match("-",true)){if(!e.match(/[a-zA-Z]/,false)){eb(b,"Invalid argument: "+c.argString.substring(f));return}var h=g;var i=e.next();if(x(h)&&x(i)||A(h)&&A(i)){var j=h.charCodeAt(0);var k=i.charCodeAt(0);if(j>=k){eb(b,"Invalid argument: "+c.argString.substring(f));return}for(var l=0;l<=k-j;l++){var m=String.fromCharCode(j+l);delete d.marks[m]}}else{eb(b,"Invalid argument: "+h+"-");return}}else{delete d.marks[g]}}}};var sb=new qb;function tb(b,c,d,e,f,g,h,i,j){b.state.vim.exMode=true;var k=false;var l=g.from();function m(){b.operation(function(){while(!k){n();o()}p()})}function n(){var a=b.getRange(g.from(),g.to());var c=a.replace(h,i);g.replace(c)}function o(){while(g.findNext()&&ob(g.from(),e,f)){if(!d&&l&&g.from().line==l.line){continue}b.scrollIntoView(g.from(),30);b.setSelection(g.from(),g.to());l=g.from();k=false;return}k=true}function p(a){if(a){a()}b.focus();if(l){b.setCursor(l);var c=b.state.vim;c.exMode=false;c.lastHPos=c.lastHSPos=l.ch}if(j){j()}}function q(c,d,e){a.e_stop(c);var f=a.keyName(c);switch(f){case"Y":n();o();break;case"N":o();break;case"A":var g=j;j=undefined;b.operation(m);j=g;break;case"L":n();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":p(e);break}if(k){p(e)}return true}o();if(k){eb(b,"No matches for "+h.source);return}if(!c){m();if(j){j()}return}hb(b,{prefix:"replace with <strong>"+i+"</strong> (y/n/a/q/l)",onKeyDown:q})}a.keyMap.vim={attach:h,detach:g,call:i};function ub(b){var c=b.state.vim;var d=L.macroModeState;var e=L.registerController.getRegister(".");var f=d.isPlaying;var g=d.lastInsertModeChanges;var h=[];if(!f){var i=g.inVisualBlock?c.lastSelection.visualBlock.height:1;var j=g.changes;var h=[];var k=0;while(k<j.length){h.push(j[k]);if(j[k]instanceof Fb){k++}else{k+=i}}g.changes=h;b.off("change",Bb);a.off(b.getInputField(),"keydown",Gb)}if(!f&&c.insertModeRepeat>1){Hb(b,c,c.insertModeRepeat-1,true);c.lastEditInputState.repeatOverride=c.insertModeRepeat}delete c.insertModeRepeat;c.insertMode=false;b.setCursor(b.getCursor().line,b.getCursor().ch-1);b.setOption("keyMap","vim");b.setOption("disableInput",true);b.toggleOverwrite(false);e.setText(g.changes.join(""));a.signal(b,"vim-mode-change",{mode:"normal"});if(d.isRecording){zb(d)}}function vb(a){b.unshift(a)}function wb(a,b,c,d,e){var f={keys:a,type:b};f[b]=c;f[b+"Args"]=d;for(var g in e)f[g]=e[g];vb(f)}E("insertModeEscKeysTimeout",200,"number");a.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(b){var c=a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent;c(b)},fallthrough:["default"],attach:h,detach:g,call:i};a.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:h,detach:g,call:i};function xb(b,c,d,e){var f=L.registerController.getRegister(e);if(e==":"){if(f.keyBuffer[0]){sb.processCommand(b,f.keyBuffer[0])}d.isPlaying=false;return}var g=f.keyBuffer;var h=0;d.isPlaying=true;d.replaySearchQueries=f.searchQueries.slice(0);for(var i=0;i<g.length;i++){var j=g[i];var k,l;while(j){k=/<\w+-.+?>|<\w+>|./.exec(j);l=k[0];j=j.substring(k.index+l.length);a.Vim.handleKey(b,l,"macro");if(c.insertMode){var m=f.insertModeChanges[h++].changes;L.macroModeState.lastInsertModeChanges.changes=m;Ib(b,m,1);ub(b)}}}d.isPlaying=false}function yb(a,b){if(a.isPlaying){return}var c=a.latestRegister;var d=L.registerController.getRegister(c);if(d){d.pushText(b)}}function zb(a){if(a.isPlaying){return}var b=a.latestRegister;var c=L.registerController.getRegister(b);if(c&&c.pushInsertModeChanges){c.pushInsertModeChanges(a.lastInsertModeChanges)}}function Ab(a,b){if(a.isPlaying){return}var c=a.latestRegister;var d=L.registerController.getRegister(c);if(d&&d.pushSearchQuery){d.pushSearchQuery(b)}}function Bb(a,b){var c=L.macroModeState;var d=c.lastInsertModeChanges;if(!c.isPlaying){while(b){d.expectCursorActivityForChange=true;if(b.origin=="+input"||b.origin=="paste"||b.origin===undefined){var e=b.text.join("\n");d.changes.push(e)}b=b.next}}}function Cb(a){var b=a.state.vim;if(b.insertMode){var c=L.macroModeState;if(c.isPlaying){return}var d=c.lastInsertModeChanges;if(d.expectCursorActivityForChange){d.expectCursorActivityForChange=false}else{d.changes=[]}}else if(!a.curOp.isVimOp){Eb(a,b)}if(b.visualMode){Db(a)}}function Db(a){var b=a.state.vim;var c=ba(a,ja(b.sel.head));var d=da(c,0,1);if(b.fakeCursor){b.fakeCursor.clear()}b.fakeCursor=a.markText(c,d,{className:"cm-animate-fat-cursor"})}function Eb(b,c){var d=b.getCursor("anchor");var e=b.getCursor("head");if(c.visualMode&&!b.somethingSelected()){Ca(b,false)}else if(!c.visualMode&&!c.insertMode&&b.somethingSelected()){c.visualMode=true;c.visualLine=false;a.signal(b,"vim-mode-change",{mode:"visual"})}if(c.visualMode){var f=!la(e,d)?-1:0;var g=la(e,d)?-1:0;e=da(e,0,f);d=da(d,0,g);c.sel={anchor:d,head:e};Qa(b,c,"<",ma(e,d));Qa(b,c,">",na(e,d))}else if(!c.insertMode){c.lastHPos=b.getCursor().ch}}function Fb(a){this.keyName=a}function Gb(b){var c=L.macroModeState;var d=c.lastInsertModeChanges;var e=a.keyName(b);if(!e){return}function f(){d.changes.push(new Fb(e));return true}if(e.indexOf("Delete")!=-1||e.indexOf("Backspace")!=-1){a.lookupKey(e,"vim-insert",f)}}function Hb(a,b,c,d){var e=L.macroModeState;e.isPlaying=true;var f=!!b.lastEditActionCommand;var g=b.inputState;function h(){if(f){V.processAction(a,b,b.lastEditActionCommand)}else{V.evalInput(a,b)}}function i(c){if(e.lastInsertModeChanges.changes.length>0){c=!b.lastEditActionCommand?1:c;var d=e.lastInsertModeChanges;Ib(a,d.changes,c)}}b.inputState=b.lastEditInputState;if(f&&b.lastEditActionCommand.interlaceInsertRepeat){for(var j=0;j<c;j++){h();i(1)}}else{if(!d){h()}i(c)}b.inputState=g;if(b.insertMode&&!d){ub(a)}e.isPlaying=false}function Ib(b,c,d){function e(c){if(typeof c=="string"){a.commands[c](b)}else{c(b)}return true}var f=b.getCursor("head");var g=L.macroModeState.lastInsertModeChanges.inVisualBlock;if(g){var h=b.state.vim;var i=h.lastSelection;var j=ea(i.anchor,i.head);ua(b,f,j.line+1);d=b.listSelections().length;b.setCursor(f)}for(var k=0;k<d;k++){if(g){b.setCursor(da(f,k,0))}for(var l=0;l<c.length;l++){var m=c[l];if(m instanceof Fb){a.lookupKey(m.keyName,"vim-insert",e)}else{var n=b.getCursor();b.replaceRange(m,n,n)}}}if(g){b.setCursor(da(f,0,1))}}M();return O};a.Vim=e()});
//# sourceMappingURL=vim.min.js.map