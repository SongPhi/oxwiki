(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../xml/xml","../meta"],a);else a(CodeMirror)})(function(a){"use strict";a.defineMode("markdown",function(b,c){var d=a.modes.hasOwnProperty("xml");var e=a.getMode(b,d?{name:"xml",htmlMode:true}:"text/plain");function f(c){if(a.findModeByName){var d=a.findModeByName(c);if(d)c=d.mime||d.mimes[0]}var e=a.getMode(b,c);return e.name=="null"?null:e}if(c.highlightFormatting===undefined)c.highlightFormatting=false;if(c.maxBlockquoteDepth===undefined)c.maxBlockquoteDepth=0;if(c.underscoresBreakWords===undefined)c.underscoresBreakWords=true;if(c.fencedCodeBlocks===undefined)c.fencedCodeBlocks=false;if(c.taskLists===undefined)c.taskLists=false;if(c.strikethrough===undefined)c.strikethrough=false;var g=0;var h="header",i="comment",j="quote",k="variable-2",l="variable-3",m="keyword",n="hr",o="tag",p="formatting",q="link",r="link",s="link",t="string",u="em",v="strong",w="strikethrough";var x=/^([*\-_])(?:\s*\1){2,}\s*$/,y=/^[*\-+]\s+/,z=/^[0-9]+([.)])\s+/,A=/^\[(x| )\](?=\s)/,B=/^(#+)(?: |$)/,C=/^ *(?:\={1,}|-{1,})\s*$/,D=/^[^#!\[\]*_\\<>` "'(~]+/;function E(a,b,c){b.f=b.inline=c;return c(a,b)}function F(a,b,c){b.f=b.block=c;return c(a,b)}function G(a){a.linkTitle=false;a.em=false;a.strong=false;a.strikethrough=false;a.quote=0;a.indentedCode=false;if(!d&&a.f==I){a.f=N;a.block=H}a.trailingSpace=0;a.trailingSpaceNewLine=false;a.thisLineHasContent=false;return null}function H(a,b){var d=a.sol();var e=b.list!==false,g=b.indentedCode;b.indentedCode=false;if(e){if(b.indentationDiff>=0){if(b.indentationDiff<4){b.indentation-=b.indentationDiff}b.list=null}else if(b.indentation>0){b.list=null;b.listDepth=Math.floor(b.indentation/4)}else{b.list=false;b.listDepth=0}}var h=null;if(b.indentationDiff>=4){a.skipToEnd();if(g||!b.prevLineHasContent){b.indentation-=4;b.indentedCode=true;return i}else{return null}}else if(a.eatSpace()){return null}else if((h=a.match(B))&&h[1].length<=6){b.header=h[1].length;if(c.highlightFormatting)b.formatting="header";b.f=b.inline;return L(b)}else if(b.prevLineHasContent&&!b.quote&&!e&&!g&&(h=a.match(C))){b.header=h[0].charAt(0)=="="?1:2;if(c.highlightFormatting)b.formatting="header";b.f=b.inline;return L(b)}else if(a.eat(">")){b.quote=d?1:b.quote+1;if(c.highlightFormatting)b.formatting="quote";a.eatSpace();return L(b)}else if(a.peek()==="["){return E(a,b,R)}else if(a.match(x,true)){b.hr=true;return n}else if((!b.prevLineHasContent||e)&&(a.match(y,false)||a.match(z,false))){var j=null;if(a.match(y,true)){j="ul"}else{a.match(z,true);j="ol"}b.indentation+=4;b.list=true;b.listDepth++;if(c.taskLists&&a.match(A,false)){b.taskList=true}b.f=b.inline;if(c.highlightFormatting)b.formatting=["list","list-"+j];return L(b)}else if(c.fencedCodeBlocks&&a.match(/^```[ \t]*([\w+#]*)/,true)){b.localMode=f(RegExp.$1);if(b.localMode)b.localState=b.localMode.startState();b.f=b.block=J;if(c.highlightFormatting)b.formatting="code-block";b.code=true;return L(b)}return E(a,b,b.inline)}function I(a,b){var c=e.token(a,b.htmlState);if(d&&b.htmlState.tagStart===null&&(!b.htmlState.context&&b.htmlState.tokenize.isInText)||b.md_inside&&a.current().indexOf(">")>-1){b.f=N;b.block=H;b.htmlState=null}return c}function J(a,b){if(a.sol()&&a.match("```",false)){b.localMode=b.localState=null;b.f=b.block=K;return null}else if(b.localMode){return b.localMode.token(a,b.localState)}else{a.skipToEnd();return i}}function K(a,b){a.match("```");b.block=H;b.f=N;if(c.highlightFormatting)b.formatting="code-block";b.code=true;var d=L(b);b.code=false;return d}function L(a){var b=[];if(a.formatting){b.push(p);if(typeof a.formatting==="string")a.formatting=[a.formatting];for(var d=0;d<a.formatting.length;d++){b.push(p+"-"+a.formatting[d]);if(a.formatting[d]==="header"){b.push(p+"-"+a.formatting[d]+"-"+a.header)}if(a.formatting[d]==="quote"){if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(p+"-"+a.formatting[d]+"-"+a.quote)}else{b.push("error")}}}}if(a.taskOpen){b.push("meta");return b.length?b.join(" "):null}if(a.taskClosed){b.push("property");return b.length?b.join(" "):null}if(a.linkHref){b.push(t,"url")}else{if(a.strong){b.push(v)}if(a.em){b.push(u)}if(a.strikethrough){b.push(w)}if(a.linkText){b.push(s)}if(a.code){b.push(i)}}if(a.header){b.push(h);b.push(h+"-"+a.header)}if(a.quote){b.push(j);if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(j+"-"+a.quote)}else{b.push(j+"-"+c.maxBlockquoteDepth)}}if(a.list!==false){var e=(a.listDepth-1)%3;if(!e){b.push(k)}else if(e===1){b.push(l)}else{b.push(m)}}if(a.trailingSpaceNewLine){b.push("trailing-space-new-line")}else if(a.trailingSpace){b.push("trailing-space-"+(a.trailingSpace%2?"a":"b"))}return b.length?b.join(" "):null}function M(a,b){if(a.match(D,true)){return L(b)}return undefined}function N(b,d){var f=d.text(b,d);if(typeof f!=="undefined")return f;if(d.list){d.list=null;return L(d)}if(d.taskList){var h=b.match(A,true)[1]!=="x";if(h)d.taskOpen=true;else d.taskClosed=true;if(c.highlightFormatting)d.formatting="task";d.taskList=false;return L(d)}d.taskOpen=false;d.taskClosed=false;if(d.header&&b.match(/^#+$/,true)){if(c.highlightFormatting)d.formatting="header";return L(d)}var i=b.sol();var j=b.next();if(j==="\\"){b.next();if(c.highlightFormatting){var k=L(d);return k?k+" formatting-escape":"formatting-escape"}}if(d.linkTitle){d.linkTitle=false;var l=j;if(j==="("){l=")"}l=(l+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var m="^\\s*(?:[^"+l+"\\\\]+|\\\\\\\\|\\\\.)"+l;if(b.match(new RegExp(m),true)){return t}}if(j==="`"){var n=d.formatting;if(c.highlightFormatting)d.formatting="code";var p=L(d);var s=b.pos;b.eatWhile("`");var u=1+b.pos-s;if(!d.code){g=u;d.code=true;return L(d)}else{if(u===g){d.code=false;return p}d.formatting=n;return L(d)}}else if(d.code){return L(d)}if(j==="!"&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){b.match(/\[[^\]]*\]/);d.inline=d.f=P;return o}if(j==="["&&b.match(/.*\](\(.*\)| ?\[.*\])/,false)){d.linkText=true;if(c.highlightFormatting)d.formatting="link";return L(d)}if(j==="]"&&d.linkText&&b.match(/\(.*\)| ?\[.*\]/,false)){if(c.highlightFormatting)d.formatting="link";var k=L(d);d.linkText=false;d.inline=d.f=P;return k}if(j==="<"&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){d.f=d.inline=O;if(c.highlightFormatting)d.formatting="link";var k=L(d);if(k){k+=" "}else{k=""}return k+q}if(j==="<"&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){d.f=d.inline=O;if(c.highlightFormatting)d.formatting="link";var k=L(d);if(k){k+=" "}else{k=""}return k+r}if(j==="<"&&b.match(/^(!--|\w)/,false)){var v=b.string.indexOf(">",b.pos);if(v!=-1){var w=b.string.substring(b.start,v);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(w))d.md_inside=true}b.backUp(1);d.htmlState=a.startState(e);return F(b,d,I)}if(j==="<"&&b.match(/^\/\w*?>/)){d.md_inside=false;return"tag"}var x=false;if(!c.underscoresBreakWords){if(j==="_"&&b.peek()!=="_"&&b.match(/(\w)/,false)){var y=b.pos-2;if(y>=0){var z=b.string.charAt(y);if(z!=="_"&&z.match(/(\w)/,false)){x=true}}}}if(j==="*"||j==="_"&&!x){if(i&&b.peek()===" "){}else if(d.strong===j&&b.eat(j)){if(c.highlightFormatting)d.formatting="strong";var p=L(d);d.strong=false;return p}else if(!d.strong&&b.eat(j)){d.strong=j;if(c.highlightFormatting)d.formatting="strong";return L(d)}else if(d.em===j){if(c.highlightFormatting)d.formatting="em";var p=L(d);d.em=false;return p}else if(!d.em){d.em=j;if(c.highlightFormatting)d.formatting="em";return L(d)}}else if(j===" "){if(b.eat("*")||b.eat("_")){if(b.peek()===" "){return L(d)}else{b.backUp(1)}}}if(c.strikethrough){if(j==="~"&&b.eatWhile(j)){if(d.strikethrough){if(c.highlightFormatting)d.formatting="strikethrough";var p=L(d);d.strikethrough=false;return p}else if(b.match(/^[^\s]/,false)){d.strikethrough=true;if(c.highlightFormatting)d.formatting="strikethrough";return L(d)}}else if(j===" "){if(b.match(/^~~/,true)){if(b.peek()===" "){return L(d)}else{b.backUp(2)}}}}if(j===" "){if(b.match(/ +$/,false)){d.trailingSpace++}else if(d.trailingSpace){d.trailingSpaceNewLine=true}}return L(d)}function O(a,b){var d=a.next();if(d===">"){b.f=b.inline=N;if(c.highlightFormatting)b.formatting="link";var e=L(b);if(e){e+=" "}else{e=""}return e+q}a.match(/^[^>]+/,true);return q}function P(a,b){if(a.eatSpace()){return null}var d=a.next();if(d==="("||d==="["){b.f=b.inline=Q(d==="("?")":"]");if(c.highlightFormatting)b.formatting="link-string";b.linkHref=true;return L(b)}return"error"}function Q(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=N;if(c.highlightFormatting)d.formatting="link-string";var f=L(d);d.linkHref=false;return f}if(b.match(V(a),true)){b.backUp(1)}d.linkHref=true;return L(d)}}function R(a,b){if(a.match(/^[^\]]*\]:/,false)){b.f=S;a.next();if(c.highlightFormatting)b.formatting="link";b.linkText=true;return L(b)}return E(a,b,N)}function S(a,b){if(a.match(/^\]:/,true)){b.f=b.inline=T;if(c.highlightFormatting)b.formatting="link";var d=L(b);b.linkText=false;return d}a.match(/^[^\]]+/,true);return s}function T(a,b){if(a.eatSpace()){return null}a.match(/^[^\s]+/,true);if(a.peek()===undefined){b.linkTitle=true}else{a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}b.f=b.inline=N;return t+" url"}var U=[];function V(a){if(!U[a]){a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");U[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")}return U[a]}var W={startState:function(){return{f:H,prevLineHasContent:false,thisLineHasContent:false,block:H,htmlState:null,indentation:0,inline:N,text:M,formatting:false,linkText:false,linkHref:false,linkTitle:false,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&a.copyState(e,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:false,linkTitle:b.linkTitle,em:b.em,strong:b.strong,strikethrough:b.strikethrough,header:b.header,hr:b.hr,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,indentedCode:b.indentedCode,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(a,b){b.formatting=false;if(a.sol()){var c=!!b.header||b.hr;b.header=0;b.hr=false;if(a.match(/^\s*$/,true)||c){b.prevLineHasContent=false;G(b);return c?this.token(a,b):null}else{b.prevLineHasContent=b.thisLineHasContent;b.thisLineHasContent=true}b.taskList=false;b.code=false;b.trailingSpace=0;b.trailingSpaceNewLine=false;b.f=b.block;var d=a.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;var e=Math.floor((d-b.indentation)/4)*4;if(e>4)e=4;var f=b.indentation+e;b.indentationDiff=f-b.indentation;b.indentation=f;if(d>0)return null}return b.f(a,b)},innerMode:function(a){if(a.block==I)return{state:a.htmlState,mode:e};if(a.localState)return{state:a.localState,mode:a.localMode};return{state:a,mode:W}},blankLine:G,getType:L,fold:"markdown"};return W},"xml");a.defineMIME("text/x-markdown","markdown")});
//# sourceMappingURL=markdown.min.js.map